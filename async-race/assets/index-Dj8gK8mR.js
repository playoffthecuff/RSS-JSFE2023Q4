var k=Object.defineProperty;var D=(i,t,e)=>t in i?k(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var n=(i,t,e)=>(D(i,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const h of r.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function e(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(a){if(a.ep)return;a.ep=!0;const r=e(a);fetch(a.href,r)}})();class o{constructor(t="div",e,s){n(this,"element");n(this,"children");this.element=document.createElement(t),e&&this.addClass(e),s&&this.setTextContent(s),this.children=[]}get node(){return this.element}getChildren(){return this.children}appendChild(t){this.children.push(t),this.node.appendChild(t.node)}appendChildren(...t){t.forEach(e=>{this.appendChild(e)})}removeChildren(){this.children.length=0,this.node.innerHTML=""}removeNode(){this.node.remove()}setId(t){this.node.id=t}setTextContent(t){this.element.textContent=t}setAttribute(t,e){this.node.hasAttribute(t)||this.node.setAttribute(t,e)}removeAttribute(t){this.node.removeAttribute(t)}addClass(t){this.node.classList.contains(t)||this.node.classList.add(t)}addClassToChildren(t){this.getChildren().forEach(e=>e.addClass(t))}removeClass(t){this.node.classList.remove(t)}removeClassFromChildren(t){this.getChildren().forEach(e=>e.removeClass(t))}toggleClass(t){this.node.classList.toggle(t)}addListener(t,e){this.node.addEventListener(t,e)}removeListener(t,e){this.node.removeEventListener(t,e)}setStyle(t,e){const s=t;this.node.style.setProperty(s,e)}}class c extends o{constructor(e,s,a="button",r="button"){super();n(this,"element");this.element=document.createElement("button"),this.addClass(r),this.setTextContent(e),this.addListener("click",s),a&&this.setAttribute("type",a)}}class M extends o{constructor(e){super();n(this,"element");this.element=document.createElement("input"),this.addClass(e)}getValue(){return this.element.value}setValue(e){this.element.value=e}}const O="#808080";class J extends M{constructor(){super("color-picker"),this.setAttribute("type","color"),this.setValue(O)}}class U extends M{constructor(){super("text-input"),this.setAttribute("type","text")}}class E extends o{constructor(e,s){super("div","input-row");n(this,"textInput");n(this,"colorPicker");n(this,"button");this.textInput=new U,this.colorPicker=new J,this.button=new c(e,s),this.appendChildren(this.textInput,this.colorPicker,this.button)}getTextValue(){return this.textInput.getValue()}getColorValue(){return this.colorPicker.getValue()}setTextValue(e){this.textInput.setValue(e)}setColorValue(e){this.colorPicker.setValue(e)}}class j extends o{constructor(e,s,a,r,h,d){super("section",e);n(this,"generateButton");n(this,"raceButton");n(this,"resetButton");n(this,"createInput");n(this,"updateInput");this.createInput=new E("CREATE",s),this.updateInput=new E("UPDATE",r),this.generateButton=new c("GENERATE CARS",a),this.raceButton=new c("RACE",h),this.resetButton=new c("RESET",d),this.resetButton.setAttribute("disabled","");const l=new o("div","row");l.appendChildren(this.raceButton,this.resetButton,this.generateButton),this.appendChildren(this.createInput,this.updateInput,l)}}class S extends o{constructor(e){super();n(this,"element");this.element=document.createElement(e),this.addClass("heading")}}class R extends o{constructor(e,s){super();n(this,"svgElement");this.svgElement=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.node.appendChild(this.svgElement),this.svgElement.classList.add("svg"),this.svgElement.setAttribute("viewBox","0 0 80 48");const a=document.createElementNS("http://www.w3.org/2000/svg","use");a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",`${e}#${s||""}`),this.svgElement.appendChild(a)}setColor(e){this.removeAttribute("style"),this.setAttribute("style",`fill: ${e}`)}}const W="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%3e%3csymbol%20viewBox='0%200%2018%2018'%20id='car'%3e%3cpath%20d='M16,6l3,4h2c1.11,0,2,0.89,2,2v3h-2c0,1.66-1.34,3-3,3s-3-1.34-3-3H9c0,1.66-1.34,3-3,3s-3-1.34-3-3H1v-3c0-1.11,0.89-2,2-2%20l3-4H16%20M10.5,7.5H6.75L4.86,10h5.64V7.5%20M12,7.5V10h5.14l-1.89-2.5H12%20M6,13.5c-0.83,0-1.5,0.67-1.5,1.5s0.67,1.5,1.5,1.5%20s1.5-0.67,1.5-1.5S6.83,13.5,6,13.5%20M18,13.5c-0.83,0-1.5,0.67-1.5,1.5s0.67,1.5,1.5,1.5s1.5-0.67,1.5-1.5S18.83,13.5,18,13.5z'%20/%3e%3c/symbol%3e%3csymbol%20viewBox='5%205%2012%2012'%20id='finish'%3e%3cpath%20d='M6%205.5V13H10.382C10.6827%2013%2010.833%2013%2010.9538%2013.0747C11.0747%2013.1493%2011.1419%2013.2838%2011.2764%2013.5528L11.7236%2014.4472C11.8581%2014.7162%2011.9253%2014.8507%2012.0462%2014.9253C12.167%2015%2012.3173%2015%2012.618%2015H17.5C17.7357%2015%2017.8536%2015%2017.9268%2014.9268C18%2014.8536%2018%2014.7357%2018%2014.5V7.5C18%207.2643%2018%207.14645%2017.9268%207.07322C17.8536%207%2017.7357%207%2017.5%207H12.618C12.3173%207%2012.167%207%2012.0462%206.92533C11.9253%206.85065%2011.8581%206.71617%2011.7236%206.44721L11.2764%205.55279C11.1419%205.28383%2011.0747%205.14935%2010.9538%205.07467C10.833%205%2010.6827%205%2010.382%205H6.5C6.2643%205%206.14645%205%206.07322%205.07322C6%205.14645%206%205.2643%206%205.5Z'%20/%3e%3cpath%20d='M6%2013V5.5C6%205.2643%206%205.14645%206.07322%205.07322C6.14645%205%206.2643%205%206.5%205H10.382C10.6827%205%2010.833%205%2010.9538%205.07467C11.0747%205.14935%2011.1419%205.28383%2011.2764%205.55279L11.7236%206.44721C11.8581%206.71617%2011.9253%206.85065%2012.0462%206.92533C12.167%207%2012.3173%207%2012.618%207H17.5C17.7357%207%2017.8536%207%2017.9268%207.07322C18%207.14645%2018%207.2643%2018%207.5V14.5C18%2014.7357%2018%2014.8536%2017.9268%2014.9268C17.8536%2015%2017.7357%2015%2017.5%2015H12.618C12.3173%2015%2012.167%2015%2012.0462%2014.9253C11.9253%2014.8507%2011.8581%2014.7162%2011.7236%2014.4472L11.2764%2013.5528C11.1419%2013.2838%2011.0747%2013.1493%2010.9538%2013.0747C10.833%2013%2010.6827%2013%2010.382%2013H6ZM6%2013V19'%20stroke='%23808080'%20fill='%23ff2040'%20stroke-width='2'%20stroke-linecap='round'%20/%3e%3c/symbol%3e%3c/svg%3e";class V extends R{constructor(t){super(W,"car"),this.addClass("car-icon"),this.tuneCar(t)}tuneCar(t){this.removeAttribute("style"),this.setAttribute("style",`fill: ${t};`)}}const X="http://127.0.0.1",_="3000",C="garage",$="engine",g="winners",N=7,B=`${X}:${_}/`;function w(i,t,e){let s="";return e&&(s="?"),t&&e&&(s="&"),`${B}${i}${t?`?_page=${t}`:""}${s}${e?`_limit=${e}`:""}`}function b(i,t){return`${B}${i}${t?`/${t}`:""}`}async function v(i){return await(await fetch(i)).json()}async function q(i){return await v(w(C,i,N))}async function z(i){return await v(b(C,i))}async function K(i){return(await fetch(w(C,0,1))).headers.get(i)}async function Z(i){await fetch(b(C,i),{method:"DELETE"})}async function H(i,t){const e={name:i,color:t};return await(await fetch(b(C),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json()}async function Q(i,t,e){const s={name:t,color:e};return await(await fetch(b(C,i),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json()}function G(i,t,e){return`${B}${i}?id=${t}&status=${e}`}async function A(i,t){return await(await fetch(G($,i,t),{method:"PATCH"})).json()}async function Y(i,t){return(await fetch(G($,i,t),{method:"PATCH"})).status}async function ee(i,t,e){const s={id:i,wins:t,time:e};return await(await fetch(w(g),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json()}async function te(i,t,e){const s={wins:t,time:e};return await(await fetch(b(g,i),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json()}async function se(i){await fetch(b(g,i),{method:"DELETE"})}async function ne(i,t,e,s){return await v(`${w(g,i,t)}&_sort=${e}&_order=${s}`)}async function ae(i){return(await fetch(w(g,0,1))).headers.get(i)}async function ie(){return await v(w(g))}class re extends o{constructor(e,s,a,r,h){super("div","lane");n(this,"model");n(this,"selectButton");n(this,"removeButton");n(this,"startButton");n(this,"stopButton");n(this,"car");n(this,"id");n(this,"controlPanel");n(this,"nameBlock");n(this,"time");n(this,"stopCar",async()=>{const e=await A(this.id,"stopped");this.car.setStyle("transition","left 200ms ease-in-out"),this.car.setStyle("left",`${e.velocity}px`),this.removeButton.removeAttribute("disabled"),this.selectButton.removeAttribute("disabled"),this.startButton.removeAttribute("disabled"),this.stopButton.setAttribute("disabled",""),this.time=0});n(this,"startCar",async()=>{this.removeButton.setAttribute("disabled",""),this.selectButton.setAttribute("disabled",""),this.startButton.setAttribute("disabled",""),this.stopButton.removeAttribute("disabled");const e=await A(this.id,"started"),s=Y(this.id,"drive"),a=e.distance/e.velocity;this.car.setStyle("transition",`left ${a}ms ease-in-out`);let r=!1;return this.car.setStyle("left",`${this.node.offsetWidth-80}px`),await s.then(h=>{const d=window.getComputedStyle(this.car.node).left;h===500?this.car.setStyle("left",d):(r=!0,this.time=Math.round(a/10)/100)}),r});this.time=0,this.model=e,this.id=a,this.setAttribute("style",`color: ${s}`),this.controlPanel=new o("div","control-panel"),this.nameBlock=new o("div","name-block",e),this.selectButton=new c("SELECT",()=>{h(),this.selectButton.setAttribute("disabled","")}),this.removeButton=new c("REMOVE",r),this.startButton=new c("START",this.startCar),this.stopButton=new c("STOP",this.stopCar),this.stopButton.setAttribute("disabled","");const d=new o("div","track");this.car=new V(s);const l=new R(W,"finish");l.addClass("finish-icon"),d.appendChildren(this.car,l),this.controlPanel.appendChildren(this.nameBlock,this.selectButton,this.removeButton,this.startButton,this.stopButton),this.appendChildren(this.controlPanel,d)}changeCarColor(e){this.car.tuneCar(e)}changeCarName(e,s){this.nameBlock.setTextContent(e),this.removeAttribute("style"),this.setAttribute("style",`color: ${s}`),this.model=e}updateCar(e,s){this.changeCarColor(s),this.changeCarName(e,s)}getWinnerStr(){return`Winner is ${this.model} with a ${this.time}s`}getId(){return this.id}getTime(){return this.time}}class L extends o{constructor(e,s){super("section","page-switcher");n(this,"prevButton");n(this,"nextButton");this.prevButton=new c("PREV",e),this.nextButton=new c("NEXT",s),this.appendChildren(this.prevButton,this.nextButton)}}function oe(i){const t=i.match(/hsl\(\s*(\d+(?:\.\d+)?|\.\d+)\s*,\s*(\d+(?:\.\d+)?|\.\d+)%\s*,\s*(\d+(?:\.\d+)?|\.\d+)%\s*\)/);if(!t)return i;const e=+t[1]/360,s=+t[2]/100,a=+t[3]/100,r=(p,m,F)=>{let u=F;return u<0&&(u+=1),u>1&&(u-=1),u<1/6?p+(m-p)*6*u:u<1/2?m:u<2/3?p+(m-p)*(2/3-u)*6:p},h=a<.5?a*(1+s):a+s-a*s,d=2*a-h,l=r(d,h,e+1/3),f=r(d,h,e),P=r(d,h,e-1/3),T=p=>{const m=Math.round(p*255).toString(16);return m.length===1?`0${m}`:m};return`#${T(l)}${T(f)}${T(P)}`}class he extends o{constructor(){super();n(this,"element");this.element=document.createElement("dialog"),this.addClass("modal-window")}openMe(){this.element.showModal()}closeMe(){this.element.close()}}const de="X-Total-Count";class le extends o{constructor(e){super("section","race-section");n(this,"garageStats");n(this,"pageIndicator");n(this,"pageNumber");n(this,"carsNumber");n(this,"lanesWrapper");n(this,"selectedCar");n(this,"selectedLane");n(this,"controlPanel");n(this,"modalWinner");n(this,"winnerId");n(this,"winnerTime");n(this,"winners");n(this,"times");n(this,"switchToPrevPage",()=>{this.pageNumber>1&&this.renderPage(this.pageNumber-1)});n(this,"switchToNextPage",()=>{this.carsNumber/N>this.pageNumber&&this.renderPage(this.pageNumber+1)});n(this,"createCar",(e,s)=>{H(e,s),this.updateCarsNumber()});n(this,"startRace",()=>{const e=this.lanesWrapper.getChildren();let s=0;e.forEach(a=>{a.startCar().then(h=>{if(!this.winnerId&&h){if(this.winnerId=a.getId(),this.winnerTime=a.getTime(),this.winners[this.winnerId]){this.winners[this.winnerId]+=1;let d=this.winnerTime;this.winnerTime>this.times[this.winnerId]&&(d=this.times[this.winnerId]),te(this.winnerId,this.winners[this.winnerId],d)}else this.winners[this.winnerId]=1,ee(this.winnerId,this.winners[this.winnerId],this.winnerTime);s+=1,this.modalWinner.setTextContent(a.getWinnerStr()),this.modalWinner.openMe()}else s+=1,s===e.length&&this.controlPanel.resetButton.removeAttribute("disabled")})})});n(this,"stopRace",()=>{this.lanesWrapper.getChildren().forEach(s=>{s.stopCar()}),this.winnerId=null,this.winnerTime=null});this.winnerId=null,this.winnerTime=null,this.winners=[],this.times=[],this.controlPanel=e,this.garageStats=new S("h1"),this.pageIndicator=new S("h2"),this.pageNumber=1,this.carsNumber=0,this.updateCarsNumber(),this.pageIndicator.setTextContent(`Page #${this.pageNumber}`),this.lanesWrapper=new o("div","lanes"),this.renderPage(this.pageNumber),this.selectedLane=null,this.modalWinner=new he,this.modalWinner.addListener("click",()=>{this.modalWinner.closeMe()});const s=new L(this.switchToPrevPage,this.switchToNextPage);this.appendChildren(this.garageStats,this.pageIndicator,this.lanesWrapper,s,this.modalWinner),this.selectedCar={id:0,name:"",color:""},this.updateStats()}async updateCarsNumber(){const e=await K(de);this.garageStats.setTextContent(`Garage (${e})`),e&&(this.carsNumber=+e)}async renderPage(e){const s=await q(e);this.lanesWrapper.removeChildren(),s.length&&e>0&&(s.forEach(a=>{const r=new re(a.name,a.color,a.id,async()=>{await Z(a.id),await se(a.id),this.winners[a.id]=void 0,this.times[a.id]=void 0,await this.renderPage(this.pageNumber),this.updateCarsNumber()},()=>{this.selectedCar={...a},this.selectedLane=r,this.lanesWrapper.getChildren().forEach(d=>d.selectButton.removeAttribute("disabled")),this.controlPanel.updateInput.setTextValue(a.name),this.controlPanel.updateInput.setColorValue(oe(a.color))});r.setId(`lane-${a.id}`),this.lanesWrapper.appendChild(r)}),this.pageNumber=e,this.pageIndicator.setTextContent(`Page #${this.pageNumber}`))}async updateStats(){(await ie()).forEach(s=>{this.winners[s.id]=s.wins,this.times[s.id]=s.time})}}const x=["Corolla","Focus","Golf","Civic","Silverado","1500","Camry","Accord","F-Series","Altima","Elantra","Equinox","Cherokee","Outback","RAV4","Escape","Sierra","Tacoma","CR-V","Malibu","Optima","Sonata","Explorer","Forester","Rogue","Wrangler","Traverse","Pilot","2500","Highlander","Mustang","Terrain","Sentra","Crosstrek","Renegade","Colorado","Santa Fe","HR-V","4Runner","Edge","Acadia","Pathfinder","Impreza","Compass","Tahoe","Odyssey","Tundra","Ranger","Tucson","Canyon","Frontier","Legacy","Gladiator","Suburban","Fit","Sienna","Expedition","Kona","Yukon","Murano","Ascent","Patriot","Impala","Ridgeline","Avalon","EcoSport","Accent","Savana","Versa","WRX","Liberty","Sonic","Clarity","Sequoia","Transit","Veloster","Yukon XL","Maxima","BRZ","Commander","Bolt EV","Insight","Yaris","Fusion","Palisade","Sierra HD","Titan","Comanche","Camaro","Passport","Prius","Flex","Genesis","Kicks","Baja","Wagoneer","Element","Taurus","Venue","Armada","Loyale","Scrambler","Express","Crosstour","Mirai","Entourage","Sierra 1500","Cube","XT","HHR","S2000","Prius c","Tiburon","Juke","SVX","Volt","Del Sol","Supra","Fiesta","Scoupe","Quest","GL","Cruze","CR-Z","MR2","GT","Excel","Leaf","Justy","SSR","Prelude","Cressida","Pinto","Stellar","Suburban","BRAT","Jeepster","Aveo","NSX","Matrix","Probe","Syclone","240SX","Tribeca","DJ","Astro","Echo","Typhoon","Stanza","FC","Caprice","FJ Cruiser","Maverick","Sprint","Almera","WRX STI","CJ","EV Plus","Previa","Festiva","Ioniq","Vandura","Micra","XT6","C-HR","Aspire","Grandeur","Caballero","Note","Venza","Contour","Starex","S-15","Pulsar","FF-1","Lumina","Model A","Santamo","Envoy","Fit EV","Corolla iM","Model T","i20"],I=["Toyota","Ford","Volkswagen","Honda","Chevrolet","Ram","Toyota","Honda","Ford","Nissan","Hyundai","Chevrolet","Jeep","Subaru","Toyota","Jeep","Ford","GMC","Toyota","Honda","Chevrolet","Kia","Hyundai","Ford","Subaru","Nissan","Jeep","Chevrolet","Honda","Ram","Toyota","Ford","GMC","Nissan","Subaru","Jeep","Chevrolet","Hyundai","Honda","Toyota","Ford","GMC","Nissan","Subaru","Jeep","Chevrolet","Honda","Toyota","Ford","Hyundai","GMC","Nissan","Subaru","Jeep","Chevrolet","Honda","Toyota","Ford","Hyundai","GMC","Nissan","Subaru","Jeep","Chevrolet","Honda","Toyota","Ford","Hyundai","GMC","Nissan","Subaru","Jeep","Chevrolet","Honda","Toyota","Ford","Hyundai","GMC","Nissan","Subaru","Jeep","Chevrolet","Honda","Toyota","Ford","Hyundai","GMC","Nissan","Jeep","Chevrolet","Honda","Toyota","Ford","Hyundai","Nissan","Subaru","Jeep","Honda","Ford","Hyundai","Nissan","Subaru","Jeep","Chevrolet","Honda","Toyota","Hyundai","GMC","Nissan","Subaru","Chevrolet","Honda","Toyota","Hyundai","GMC","Nissan","Subaru","Chevrolet","Honda","Toyota","Ford","Hyundai","Nissan","Subaru","Chevrolet","Honda","Toyota","Ford","Hyundai","GMC","Nissan","Subaru","Chevrolet","Honda","Toyota","Ford","Hyundai","GMC","Subaru","Jeep","Chevrolet","Honda","Toyota","Ford","GMC","Nissan","Subaru","Jeep","Chevrolet","Toyota","Ford","GMC","Nissan","Jeep","Chevrolet","Toyota","Ford","GMC","Nissan","Subaru","Jeep","Honda","Toyota","Ford","Hyundai","GMC","Nissan","Subaru","Toyota","Ford","Hyundai","GMC","Nissan","Toyota","Ford","Hyundai","GMC","Nissan","Subaru","Chevrolet","Ford","Hyundai","GMC","Honda","Toyota","Ford","Hyundai"],ce=100;class ue extends o{constructor(e){super("div",e);n(this,"controlPanel");n(this,"raceSection");this.controlPanel=new j("control-panel",async()=>{await H(this.controlPanel.createInput.getTextValue(),this.controlPanel.createInput.getColorValue()),this.raceSection.updateCarsNumber(),this.updateViewRaceSection(),this.controlPanel.createInput.setTextValue(""),this.controlPanel.createInput.setColorValue("#808080")},async()=>{const s=[];for(let a=0;a<ce;a+=1){const r=I[Math.floor(Math.random()*I.length)],h=x[Math.floor(Math.random()*x.length)],d=`${r} ${h}`,l=`hsl(${Math.floor(Math.random()*360)}, ${64+Math.ceil(Math.random()*36)}%, 72%)`;s.push(H(d,l))}await Promise.all(s),this.raceSection.updateCarsNumber(),this.updateViewRaceSection()},async()=>{if(this.controlPanel.updateInput.getTextValue()&&this.raceSection.selectedCar.id){await Q(this.raceSection.selectedCar.id,this.controlPanel.updateInput.getTextValue(),this.controlPanel.updateInput.getColorValue());let s=this.raceSection.selectedLane;s.updateCar(this.controlPanel.updateInput.getTextValue(),this.controlPanel.updateInput.getColorValue()),this.controlPanel.updateInput.setTextValue(""),this.controlPanel.updateInput.setColorValue("#808080"),s==null||s.selectButton.removeAttribute("disabled"),s=null,this.raceSection.selectedCar.id=0}},()=>{this.raceSection.startRace(),this.controlPanel.raceButton.setAttribute("disabled","")},()=>{this.raceSection.stopRace(),this.controlPanel.resetButton.setAttribute("disabled",""),this.controlPanel.raceButton.removeAttribute("disabled")}),this.raceSection=new le(this.controlPanel),this.appendChildren(this.controlPanel,this.raceSection)}updateViewRaceSection(){this.raceSection.carsNumber/N<this.raceSection.pageNumber&&this.raceSection.renderPage(this.raceSection.pageNumber)}}class pe extends o{constructor(e,s){super("header","header");n(this,"toGarageButton");n(this,"toWinnersButton");this.toGarageButton=new c("TO GARAGE",e),this.toWinnersButton=new c("TO WINNERS",s),this.toGarageButton.setAttribute("disabled",""),this.appendChildren(this.toGarageButton,this.toWinnersButton)}toggleToGarageButton(){this.toGarageButton.removeAttribute("disabled"),this.toWinnersButton.setAttribute("disabled","")}toggleToWinnersButton(){this.toGarageButton.setAttribute("disabled",""),this.toWinnersButton.removeAttribute("disabled")}}class y extends o{constructor(e,s){super("div","table-head");n(this,"state");n(this,"textBlock");n(this,"sortBlock");n(this,"switchToAscSort",()=>{this.sortBlock.setTextContent("▲"),this.activate(),this.state="ASC"});n(this,"switchToDescSort",()=>{this.sortBlock.setTextContent("▼"),this.activate(),this.state="DESC"});this.state="DESC",this.textBlock=new o("div","text-block",e),this.sortBlock=new o("div","sort-block"),s&&this.addListener("click",s),this.appendChildren(this.textBlock,this.sortBlock)}activate(){this.addClass("active")}deactivate(){this.removeClass("active")}getState(){return this.state}}const me=10;class Ce extends o{constructor(e,s,a){super("div","winner-table");n(this,"tableHeader");n(this,"idHead");n(this,"carHead");n(this,"nameHead");n(this,"winsHead");n(this,"timeHead");n(this,"tableBody");n(this,"pageNumber");n(this,"order");n(this,"sort");n(this,"sortByWins",()=>{this.deactivateTableHeads(),this.winsHead.getState()==="ASC"?this.winsHead.switchToDescSort():this.winsHead.switchToAscSort(),this.renderTable(this.pageNumber,"wins",this.winsHead.getState())});n(this,"sortByTime",()=>{this.deactivateTableHeads(),this.timeHead.getState()==="ASC"?this.timeHead.switchToDescSort():this.timeHead.switchToAscSort(),this.renderTable(this.pageNumber,"time",this.timeHead.getState())});this.tableHeader=new o("div","table-header"),this.idHead=new y("#"),this.carHead=new y("Car"),this.nameHead=new y("Name"),this.winsHead=new y("Wins",this.sortByWins),this.timeHead=new y("Time",this.sortByTime),this.tableHeader.appendChildren(this.idHead,this.carHead,this.nameHead,this.winsHead,this.timeHead),this.tableBody=new o("div","table-body"),this.appendChildren(this.tableHeader,this.tableBody),this.pageNumber=e,this.order=s||"ASC",this.sort=a||"id",this.renderTable(e,this.sort,this.order)}async renderTable(e,s,a){this.sort=s,this.order=a;const r=await ne(e,me,s,a);this.tableBody.removeChildren(),r.forEach(h=>{this.appendRow(h.id,h.wins,h.time)})}async appendRow(e,s,a){const r=new o("div","table-row"),h=await z(e),d=new o("div","table-cell",`${e}`),l=new V(h.color);l.addClass("table-cell");const f=new o("div","table-cell",h.name),P=new o("div","table-cell",`${s}`),T=new o("div","table-cell",`${a}`);r.appendChildren(d,l,f,P,T),this.tableBody.appendChild(r)}deactivateTableHeads(){this.carHead.deactivate(),this.idHead.deactivate(),this.nameHead.deactivate(),this.timeHead.deactivate(),this.winsHead.deactivate()}getOrder(){return this.order}getSort(){return this.sort}setPageNumber(e){this.pageNumber=e}}const ge=10,we="X-Total-Count";class be extends o{constructor(){super("div","winner-page");n(this,"winnersStats");n(this,"pageIndicator");n(this,"pageNumber");n(this,"winnersNumber");n(this,"pageSwitcher");n(this,"winnersTable");n(this,"tableWrapper");n(this,"switchToPrevPage",()=>{this.pageNumber>1&&this.renderTable(this.pageNumber-1)});n(this,"switchToNextPage",()=>{this.winnersNumber/ge>this.pageNumber&&this.renderTable(this.pageNumber+1)});this.winnersStats=new S("h1"),this.updateWinnersNumber(),this.pageIndicator=new S("h2"),this.pageNumber=1,this.pageIndicator.setTextContent(`Page #${this.pageNumber}`),this.winnersTable=new Ce(this.pageNumber),this.tableWrapper=new o,this.tableWrapper.appendChild(this.winnersTable),this.winnersNumber=0,this.pageSwitcher=new L(this.switchToPrevPage,this.switchToNextPage),this.appendChildren(this.winnersStats,this.pageIndicator,this.tableWrapper,this.pageSwitcher)}async updateWinnersNumber(){const e=await ae(we);this.winnersStats.setTextContent(`Winners (${e})`),e&&(this.winnersNumber=+e)}renderTable(e){var s;(s=this.winnersTable)==null||s.renderTable(e,this.winnersTable.getSort(),this.winnersTable.getOrder()),this.pageNumber=e,this.winnersTable.setPageNumber(e),this.pageIndicator.setTextContent(`Page #${this.pageNumber}`)}getCurrentPageNumber(){return this.pageNumber}}class Te extends o{constructor(e){super("div",e);n(this,"header");n(this,"garagePage");n(this,"winnersPage");n(this,"toWinnersPage",()=>{this.garagePage.removeNode(),this.winnersPage.updateWinnersNumber(),this.winnersPage.renderTable(this.winnersPage.getCurrentPageNumber()),this.appendChild(this.winnersPage),this.header.toggleToGarageButton()});n(this,"toGaragePage",()=>{this.winnersPage.removeNode(),this.appendChild(this.garagePage),this.header.toggleToWinnersButton()});this.header=new pe(this.toGaragePage,this.toWinnersPage),this.garagePage=new ue("garage-page"),this.winnersPage=new be,this.appendChildren(this.header,this.garagePage)}}const ye=new Te("wrapper");document.body.appendChild(ye.node);
