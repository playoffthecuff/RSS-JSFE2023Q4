var D=Object.defineProperty;var G=(r,s,e)=>s in r?D(r,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[s]=e;var i=(r,s,e)=>(G(r,typeof s!="symbol"?s+"":s,e),e);(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&t(d)}).observe(document,{childList:!0,subtree:!0});function e(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function t(n){if(n.ep)return;n.ep=!0;const a=e(n);fetch(n.href,a)}})();const F="_error-msg_86ta0_1",Z="_no-page-msg_86ta0_5",W={"error-msg":"_error-msg_86ta0_1",errorMsg:F,"no-page-msg":"_no-page-msg_86ta0_5",noPageMsg:Z},S="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20enable-background='new%200%200%2024%2024'%20height='24'%20viewBox='0%200%2024%2024'%20width='24'%3e%3crect%20fill='none'%20height='24'%20width='24'/%3e%3cg%3e%3cpath%20d='M16.88,2.88L16.88,2.88c-0.49-0.49-1.28-0.49-1.77,0l-8.41,8.41c-0.39,0.39-0.39,1.02,0,1.41l8.41,8.41%20c0.49,0.49,1.28,0.49,1.77,0l0,0c0.49-0.49,0.49-1.28,0-1.77L9.54,12l7.35-7.35C17.37,4.16,17.37,3.37,16.88,2.88z'/%3e%3c/g%3e%3c/svg%3e";class o{constructor(s,e="div",t){i(this,"childrenArr");i(this,"element");this.element=document.createElement(e),s&&this.addClass(s),t&&(this.textContent=t),this.childrenArr=[]}get node(){return this.element}get children(){return this.childrenArr}get textContent(){return this.element.textContent||""}set textContent(s){this.element.textContent=s}get id(){return this.node.id}set id(s){this.node.id=s}appendChild(s){this.children.push(s),this.node.appendChild(s.node)}appendChildren(...s){s.forEach(e=>{this.appendChild(e)})}prepend(s){this.children.push(s),this.node.prepend(s.node)}removeChildren(){this.children.length=0,this.node.innerHTML=""}removeNode(){this.node.remove()}removeSelf(){this.removeChildren(),this.removeNode()}setStyle(s,e){const t=s;this.node.style.setProperty(t,e)}setAttribute(s,e){this.node.setAttribute(s,e||"")}removeAttribute(s){this.node.removeAttribute(s)}addClass(s){this.node.classList.contains(s)||this.node.classList.add(s)}toggleClass(s){this.node.classList.toggle(s)}removeClass(s){this.node.classList.remove(s)}addClassToChildren(s){this.children.forEach(e=>e.addClass(s))}removeClassFromChildren(s){this.children.forEach(e=>e.removeClass(s))}addClassToChild(s,e){this.children[s]&&this.children[s].addClass(e)}removeClassFromChild(s,e){this.children[s]&&this.children[s].removeClass(e)}addListener(s,e){this.node.addEventListener(s,e)}removeListener(s,e){this.node.removeEventListener(s,e)}}const J="_heading_1q6e1_1",K={heading:J};class b extends o{constructor(e,t,n){super();i(this,"element");this.element=document.createElement(e),this.addClass(K.heading),n&&this.addClass(n),this.textContent=t}}const X="_button_rm83u_1",Y="_hidden_rm83u_15",Q={button:X,hidden:Y},ee="_icon_1g5nx_1",te="_hidden_1g5nx_5",se={icon:ee,hidden:te};class k extends o{constructor(e,t,n){super();i(this,"element");this.element=document.createElement("img"),t?this.addClass(t):this.addClass(se.icon),this.node.setAttribute("src",e),n&&this.node.setAttribute("alt",n)}}class m extends o{constructor(e,t="button",n,a,d,h,_){super();i(this,"element");this.element=document.createElement("button"),this.addClass(Q.button),e&&this.addListener("click",e),t&&this.setAttribute("type",t),a&&this.addClass(a),d&&(this.node.id=d),_&&(this.node.textContent=_),n&&this.appendChild(new k(n,h||""))}disable(){this.setAttribute("disabled")}enable(){this.removeAttribute("disabled")}}const ne="An error occurred:",ie="the page you requested does not exist.";class oe extends o{constructor(){super("main","main"),this.render()}render(){const s=new b("h1",ne,W.errorMsg),e=new b("h2",ie,W.noPageMsg),t=new m(()=>{window.history.back()},"button",S);this.appendChildren(s,e,t)}}const ae="_about-wrapper_ilo8m_1",re="_app-name_ilo8m_8",de="_article_ilo8m_16",ce="_inline-icon_ilo8m_20",B={"about-wrapper":"_about-wrapper_ilo8m_1",aboutWrapper:ae,"app-name":"_app-name_ilo8m_8",appName:re,article:de,"inline-icon":"_inline-icon_ilo8m_20",inlineIcon:ce},z="data:image/svg+xml,%3csvg%20width='98'%20height='96'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M48.854%200C21.839%200%200%2022%200%2049.217c0%2021.756%2013.993%2040.172%2033.405%2046.69%202.427.49%203.316-1.059%203.316-2.362%200-1.141-.08-5.052-.08-9.127-13.59%202.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015%204.934.326%207.523%205.052%207.523%205.052%204.367%207.496%2011.404%205.378%2014.235%204.074.404-3.178%201.699-5.378%203.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283%200-5.378%201.94-9.778%205.014-13.2-.485-1.222-2.184-6.275.486-13.038%200%200%204.125-1.304%2013.426%205.052a46.97%2046.97%200%200%201%2012.214-1.63c4.125%200%208.33.571%2012.213%201.63%209.302-6.356%2013.427-5.052%2013.427-5.052%202.67%206.763.97%2011.816.485%2013.038%203.155%203.422%205.015%207.822%205.015%2013.2%200%2018.905-11.404%2023.06-22.324%2024.283%201.78%201.548%203.316%204.481%203.316%209.126%200%206.6-.08%2011.897-.08%2013.526%200%201.304.89%202.853%203.316%202.364%2019.412-6.52%2033.405-24.935%2033.405-46.691C97.707%2022%2075.788%200%2048.854%200z'%20fill='%23aee58a'/%3e%3c/svg%3e",le="_icon-link_1jgus_1",he="_hidden_1jgus_13",ue="_icon_1jgus_1",pe={"icon-link":"_icon-link_1jgus_1",iconLink:le,hidden:he,icon:ue};class R extends o{constructor(e){super();i(this,"icon");i(this,"element");const{href:t,iconSrc:n="",iconAlt:a="",textContent:d="",className:h="",blank:_=!0}=e;this.element=document.createElement("a"),this.addClass(pe.iconLink),h&&this.addClass(h),this.setAttribute("href",t),d&&(this.node.textContent=d),n&&(this.icon=new k(n,a||""),this.appendChild(this.icon)),_&&this.setAttribute("target","_blank")}}const ge="Have a nice chat.<br>App by ",me="https://github.com/rolling-scopes-school/playoffthecuff-JSFE2023Q4/",_e={href:me,iconSrc:z,className:B.inlineIcon};class we extends o{constructor(){super("main","main"),this.render()}render(){const s=new o(B.aboutWrapper),e=new b("h1","Fun Chat",B.appName),t=new o(B.article,"article"),n=new R(_e),a=new m(()=>{window.history.back()},"button",S);t.node.innerHTML=ge,t.appendChild(n),s.appendChildren(e,t,a),this.appendChild(s)}}const fe="_chat_46lj4_1",ve="_chat-page_46lj4_7",Me="_chat-section_46lj4_11",be="_chat-wrapper_46lj4_25",Ce="_hint-message_46lj4_50",xe="_hidden_46lj4_58",Le="_chat-title_46lj4_62",ke="_nick-name_46lj4_72",ye="_chatterer-status_46lj4_78",Se="_send-message_46lj4_83",Ie="_send-message-input_46lj4_93",Be="_low-button_46lj4_98",Ne="_return-button_46lj4_1",Ee="_user-list_46lj4_118",Te="_side-bar_46lj4_161",Re="_visible_46lj4_174",Ae="_search-input_46lj4_185",Ue="_divider_46lj4_189",We="_divider-text_46lj4_202",Oe="_cancel-edit-button_46lj4_211",l={chat:fe,"chat-page":"_chat-page_46lj4_7",chatPage:ve,"chat-section":"_chat-section_46lj4_11",chatSection:Me,"chat-wrapper":"_chat-wrapper_46lj4_25",chatWrapper:be,"hint-message":"_hint-message_46lj4_50",hintMessage:Ce,hidden:xe,"chat-title":"_chat-title_46lj4_62",chatTitle:Le,"nick-name":"_nick-name_46lj4_72",nickName:ke,"chatterer-status":"_chatterer-status_46lj4_78",chattererStatus:ye,"send-message":"_send-message_46lj4_83",sendMessage:Se,"send-message-input":"_send-message-input_46lj4_93",sendMessageInput:Ie,"low-button":"_low-button_46lj4_98",lowButton:Be,"return-button":"_return-button_46lj4_1",returnButton:Ne,"user-list":"_user-list_46lj4_118",userList:Ee,"side-bar":"_side-bar_46lj4_161",sideBar:Te,visible:Re,"search-input":"_search-input_46lj4_185",searchInput:Ae,divider:Ue,"divider-text":"_divider-text_46lj4_202",dividerText:We,"cancel-edit-button":"_cancel-edit-button_46lj4_211",cancelEditButton:Oe},Pe="_message-wrapper_15bw2_1",qe="_context-menu_15bw2_10",Ve="_hidden_15bw2_24",ze="_title_15bw2_29",$e="_nick-name-block_15bw2_37",je="_date-block_15bw2_41",He="_message-block_15bw2_46",De="_text-block_15bw2_51",Ge="_state-icon_15bw2_62",Fe="_state-block_15bw2_68",Ze="_own_15bw2_73",Je="_chatterer_15bw2_77",u={"message-wrapper":"_message-wrapper_15bw2_1",messageWrapper:Pe,"context-menu":"_context-menu_15bw2_10",contextMenu:qe,hidden:Ve,title:ze,"nick-name-block":"_nick-name-block_15bw2_37",nickNameBlock:$e,"date-block":"_date-block_15bw2_41",dateBlock:je,"message-block":"_message-block_15bw2_46",messageBlock:He,"text-block":"_text-block_15bw2_51",textBlock:De,"state-icon":"_state-icon_15bw2_62",stateIcon:Ge,"state-block":"_state-block_15bw2_68",stateBlock:Fe,own:Ze,chatterer:Je},Ke="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%200%2024%2024'%20width='24'%3e%3cpath%20d='M0%200h24v24H0V0z'%20fill='none'/%3e%3cpath%20d='M3.4%2020.4l17.45-7.48c.81-.35.81-1.49%200-1.84L3.4%203.6c-.66-.29-1.39.2-1.39.91L2%209.12c0%20.5.37.93.87.99L17%2012%202.87%2013.88c-.5.07-.87.5-.87%201l.01%204.61c0%20.71.73%201.2%201.39.91z'/%3e%3c/svg%3e",Xe="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%200%2024%2024'%20width='24'%3e%3cpath%20d='M0%200h24v24H0V0z'%20fill='none'/%3e%3cpath%20d='M13.89%208.7L12%2010.59%2010.11%208.7c-.39-.39-1.02-.39-1.41%200-.39.39-.39%201.02%200%201.41L10.59%2012%208.7%2013.89c-.39.39-.39%201.02%200%201.41.39.39%201.02.39%201.41%200L12%2013.41l1.89%201.89c.39.39%201.02.39%201.41%200%20.39-.39.39-1.02%200-1.41L13.41%2012l1.89-1.89c.39-.39.39-1.02%200-1.41-.39-.38-1.03-.38-1.41%200zM12%202C6.47%202%202%206.47%202%2012s4.47%2010%2010%2010%2010-4.47%2010-10S17.53%202%2012%202zm0%2018c-4.41%200-8-3.59-8-8s3.59-8%208-8%208%203.59%208%208-3.59%208-8%208z'/%3e%3c/svg%3e",Ye="_user-block_3k1et_10",Qe="_user-icon_3k1et_18",et="_user-name_3k1et_26",tt="_control-panel_3k1et_33",st="_app-name_3k1et_40",x={"user-block":"_user-block_3k1et_10",userBlock:Ye,"user-icon":"_user-icon_3k1et_18",userIcon:Qe,"user-name":"_user-name_3k1et_26",userName:et,"control-panel":"_control-panel_3k1et_33",controlPanel:tt,"app-name":"_app-name_3k1et_40",appName:st},nt="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%200%2024%2024'%20width='24'%3e%3cpath%20d='M0%200h24v24H0V0z'%20fill='none'/%3e%3cpath%20d='M12%2012c2.21%200%204-1.79%204-4s-1.79-4-4-4-4%201.79-4%204%201.79%204%204%204zm0%202c-2.67%200-8%201.34-8%204v1c0%20.55.45%201%201%201h14c.55%200%201-.45%201-1v-1c0-2.66-5.33-4-8-4z'/%3e%3c/svg%3e",$="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%200%2024%2024'%20width='24'%3e%3cg%20fill='none'%3e%3cpath%20d='M0%200h24v24H0V0z'/%3e%3cpath%20d='M0%200h24v24H0V0z'%20opacity='.87'/%3e%3c/g%3e%3cpath%20d='M11%207h2v2h-2zm1%2010c.55%200%201-.45%201-1v-4c0-.55-.45-1-1-1s-1%20.45-1%201v4c0%20.55.45%201%201%201zm0-15C6.48%202%202%206.48%202%2012s4.48%2010%2010%2010%2010-4.48%2010-10S17.52%202%2012%202zm0%2018c-4.41%200-8-3.59-8-8s3.59-8%208-8%208%203.59%208%208-3.59%208-8%208z'/%3e%3c/svg%3e",it="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20enable-background='new%200%200%2024%2024'%20height='24'%20viewBox='0%200%2024%2024'%20width='24'%3e%3cg%3e%3cpath%20d='M0,0h24v24H0V0z'%20fill='none'/%3e%3c/g%3e%3cg%3e%3cg%3e%3cpath%20d='M5,5h6c0.55,0,1-0.45,1-1v0c0-0.55-0.45-1-1-1H5C3.9,3,3,3.9,3,5v14c0,1.1,0.9,2,2,2h6c0.55,0,1-0.45,1-1v0%20c0-0.55-0.45-1-1-1H5V5z'/%3e%3cpath%20d='M20.65,11.65l-2.79-2.79C17.54,8.54,17,8.76,17,9.21V11h-7c-0.55,0-1,0.45-1,1v0c0,0.55,0.45,1,1,1h7v1.79%20c0,0.45,0.54,0.67,0.85,0.35l2.79-2.79C20.84,12.16,20.84,11.84,20.65,11.65z'/%3e%3c/g%3e%3c/g%3e%3c/svg%3e",v=class v{constructor(s){i(this,"wsConnection");i(this,"url");this.wsConnection=new WebSocket(s),this.url=s}static getWS(s){return v.instance||(v.instance=new v(s)),v.instance}get ws(){return this.wsConnection}repeatConnect(){this.wsConnection=new WebSocket(this.url)}};i(v,"instance");let g=v;function ot(){let r=0;return()=>{const s=r;return r+=1,s}}const p=ot(),M=class M{constructor(s){i(this,"userData",{login:"",isLogined:!1,password:""});i(this,"unreadMessagesNumber",new Map);i(this,"messages",new Map);i(this,"sendMessages",new Map);i(this,"isThereUnreadMessage",!1);i(this,"scrollMode","manual");this.userData.login=s}static getSession(s){return M.instance||(M.instance=new M(s||"JohnDoe")),M.instance}get user(){return this.userData}get isThereUnread(){return this.isThereUnreadMessage}set isThereUnread(s){this.isThereUnreadMessage=s}getMessage(s){return this.messages.get(s)}getSendedMessage(s){return this.sendMessages.get(s)}putMessage(s,e){this.messages.set(s,e)}putSendedMessage(s,e){this.sendMessages.set(s,e)}deleteMessage(s){var e;(e=this.messages.get(s))==null||e.removeSelf(),this.messages.delete(s)}clearMessages(){this.messages.clear()}clearSendMessages(){this.sendMessages.clear()}iterateMessages(s){this.messages.forEach(s)}setAllMessagesAsRead(){this.messages.forEach(s=>{!s.isRead()&&s.getFrom()!==this.user.login&&g.getWS().ws.send(JSON.stringify({id:String(p()),type:"MSG_READ",payload:{message:{id:s.id}}}))})}addEntryToUnreadMessagesNumber(s){this.unreadMessagesNumber.set(s,0)}incrementUnreadMessagesNumber(s){const e=this.unreadMessagesNumber.get(s)||0;this.unreadMessagesNumber.set(s,e+1)}decrementUnreadMessagesNumber(s){if(s){const e=this.unreadMessagesNumber.get(s)||1;this.unreadMessagesNumber.set(s,e-1)}}getUnreadMessagesNumber(s){return this.unreadMessagesNumber.get(s)}clearUnreadMessagesNumber(){this.unreadMessagesNumber.clear()}setScrollModeToAuto(){this.scrollMode="auto"}setScrollModeToManual(){this.scrollMode="manual"}getScrollMode(){return this.scrollMode}};i(M,"instance");let C=M;class at extends o{constructor(e){super(x.header,"header");i(this,"ws",g.getWS().ws);i(this,"user",C.getSession().user);i(this,"infoButton",new m(()=>{window.location.hash="/about"},"button",$));i(this,"logoutButton",new m(()=>{this.ws.send(JSON.stringify({id:String(p()),type:"USER_LOGOUT",payload:{user:{login:this.user.login,password:this.user.password}}}))},"button",it));this.render(e)}render(e){this.createUserBlock(e),this.createHeading(),this.createControlPanel()}createUserBlock(e){const t=new o(x.userBlock),n=new k(nt,x.userIcon),a=new b("h3",e,x.userName);t.appendChildren(n,a),this.appendChild(t)}createHeading(){const e=new b("h1","Fun Chat",x.appName);this.appendChild(e)}createControlPanel(){const e=new o(x.controlPanel);e.appendChildren(this.infoButton,this.logoutButton),this.appendChild(e)}setWS(e){this.ws=e}}const rt="_user-block_1f6i0_15",dt="_rss-icon_1f6i0_21",ct="_gh-icon_1f6i0_31",lt="_author-name_1f6i0_35",ht="_year_1f6i0_41",y={"user-block":"_user-block_1f6i0_15",userBlock:rt,"rss-icon":"_rss-icon_1f6i0_21",rssIcon:dt,"gh-icon":"_gh-icon_1f6i0_31",ghIcon:ct,"author-name":"_author-name_1f6i0_35",authorName:lt,year:ht},ut="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20552.85%20198.67'%3e%3ctitle%3ers_school%3c/title%3e%3cg%20data-name='Layer%202'%3e%3cg%20data-name='Layer%201'%3e%3cpath%20d='M275.36%2061.37l26.29-1.65q.86%206.41%203.48%209.76%204.28%205.43%2012.2%205.43%205.91%200%209.12-2.77a8.34%208.34%200%200%200%203.2-6.44%208.18%208.18%200%200%200-3-6.22q-3-2.74-14.15-5.19-18.18-4.08-25.93-10.86a21.84%2021.84%200%200%201-7.81-17.26%2023.44%2023.44%200%200%201%204-13%2026.47%2026.47%200%200%201%2012-9.64q8-3.51%2022-3.51%2017.14%200%2026.14%206.38t10.71%2020.28l-26.05%201.52q-1-6-4.36-8.78t-9.2-2.77c-3.21%200-5.63.69-7.25%202.05a6.25%206.25%200%200%200-2.44%205%205%205%200%200%200%202%203.84q1.95%201.77%209.27%203.3%2018.12%203.9%2026%207.9t11.4%209.91a25.12%2025.12%200%200%201%203.57%2013.24%2028.37%2028.37%200%200%201-4.75%2015.86%2029.83%2029.83%200%200%201-13.3%2011q-8.55%203.75-21.54%203.75-22.81%200-31.6-8.78t-10-22.35zM6.27%2091V1.53h46.06q12.81%200%2019.58%202.19a20.93%2020.93%200%200%201%2010.92%208.14A24.75%2024.75%200%200%201%2087%2026.35a24.8%2024.8%200%200%201-3.2%2012.84A24.91%2024.91%200%200%201%2075.07%2048a33.63%2033.63%200%200%201-9.7%203.54%2027.79%2027.79%200%200%201%207.19%203.29A27.79%2027.79%200%200%201%2077%2059.49%2035.16%2035.16%200%200%201%2080.85%2065l13.38%2026H63L48.24%2063.63q-2.81-5.31-5-6.9a11.63%2011.63%200%200%200-6.78-2.07H34V91zM34%2037.76h11.68A41%2041%200%200%200%2053%2036.54a7.3%207.3%200%200%200%204.48-2.81%208.24%208.24%200%200%200%201.74-5.18%208.23%208.23%200%200%200-2.75-6.65q-2.74-2.32-10.31-2.32H34zM0%20167.56l26.29-1.64q.86%206.41%203.48%209.76Q34%20181.11%2042%20181.11q5.91%200%209.12-2.78a8.34%208.34%200%200%200%203.2-6.44%208.2%208.2%200%200%200-3-6.22q-3-2.74-14.15-5.18-18.18-4.1-25.93-10.86a21.87%2021.87%200%200%201-7.81-17.27%2023.49%2023.49%200%200%201%204-13%2026.47%2026.47%200%200%201%2012-9.64q8-3.51%2022-3.51%2017.14%200%2026.14%206.38t10.71%2020.28l-26%201.53q-1-6-4.36-8.79t-9.19-2.74q-4.81%200-7.25%202a6.25%206.25%200%200%200-2.44%205%205%205%200%200%200%202%203.85q1.95%201.77%209.27%203.29%2018.12%203.9%2026%207.9t11.4%209.91a25.15%2025.15%200%200%201%203.57%2013.24%2028.35%2028.35%200%200%201-4.75%2015.86%2029.83%2029.83%200%200%201-13.3%2011q-8.55%203.75-21.54%203.75-22.81%200-31.6-8.78T0%20167.56zm163-7.01l24.22%207.32a44.72%2044.72%200%200%201-7.69%2017%2033.46%2033.46%200%200%201-13%2010.31q-7.78%203.47-19.8%203.47-14.58%200-23.82-4.23t-16-14.91q-6.72-10.67-6.71-27.31%200-22.18%2011.8-34.11t33.4-11.92q16.91%200%2026.57%206.84t14.36%2021l-24.4%205.43a21%2021%200%200%200-2.68-6%2016%2016%200%200%200-5.67-4.88%2016.31%2016.31%200%200%200-7.51-1.71q-9.39%200-14.39%207.56-3.8%205.61-3.79%2017.61%200%2014.86%204.52%2020.38t12.69%205.51q7.92%200%2012-4.45t5.9-12.91zm45.51-52.83h27.63V139h30.2v-31.28h27.75v89.43h-27.75V161h-30.2v36.18h-27.63zm102.78%2044.77q0-21.88%2012.2-34.1t34-12.2q22.32%200%2034.4%2012T404%20151.76q0%2015.69-5.28%2025.72a37.54%2037.54%200%200%201-15.25%2015.61q-10%205.58-24.86%205.58-15.12%200-25-4.82a37.59%2037.59%200%200%201-16.07-15.25q-6.26-10.42-6.25-26.11zm27.63.13q0%2013.55%205%2019.46t13.7%205.91q8.91%200%2013.79-5.79t4.88-20.8q0-12.63-5.1-18.46t-13.82-5.82A16.78%2016.78%200%200%200%20344%20133q-5.07%206-5.08%2019.62z'/%3e%3cpath%20d='M392.28%20152.49q0-21.88%2012.2-34.1t34-12.2q22.34%200%2034.41%2012t12.07%2033.58q0%2015.69-5.27%2025.72a37.6%2037.6%200%200%201-15.25%2015.61q-10%205.58-24.86%205.58-15.13%200-25-4.82a37.67%2037.67%200%200%201-16.08-15.25q-6.22-10.43-6.22-26.12zm27.64.13q0%2013.55%205%2019.46t13.72%205.92q8.91%200%2013.79-5.79t4.88-20.8q0-12.63-5.09-18.46t-13.82-5.82A16.77%2016.77%200%200%200%20425%20133q-5.09%206-5.08%2019.62z'/%3e%3cpath%20d='M482.08%20107.72h27.64v67.41h43.13v22h-70.77z'/%3e%3c/g%3e%3c/g%3e%3c/svg%3e",pt="https://rs.school/",gt="https://github.com/playoffthecuff",mt="evgenii",_t={href:gt,iconSrc:z,className:y.ghIcon},wt={href:pt,iconSrc:ut,className:y.rssIcon};class ft extends o{constructor(){super(void 0,"footer"),this.render()}render(){this.createRSSLink(),this.createUserBlock(),this.createYear()}createRSSLink(){const s=new R(wt);this.appendChild(s)}createUserBlock(){const s=new o(y.userBlock),e=new R(_t),t=new b("h3",mt,y.authorName);s.appendChildren(e,t),this.appendChild(s)}createYear(){const s=new b("h2",new Date().getFullYear().toString(),y.year);this.appendChild(s)}}const vt="_text-input_1a6ht_1",Mt="_invalid_1a6ht_11",N={"text-input":"_text-input_1a6ht_1",textInput:vt,invalid:Mt};class j extends o{constructor(e){super();i(this,"element");this.element=document.createElement("input"),this.addClass(e)}get value(){return this.element.value}set value(e){this.element.value=e}}class A extends j{constructor(s,e){super(N.textInput),this.setAttribute("type","text"),s&&this.setAttribute("placeholder",s),e&&this.addClass(e)}setInvalid(){this.addClass(N.invalid)}setValid(){this.removeClass(N.invalid)}}const bt="_offline_1qbyb_1",Ct="_unread-messages_1qbyb_8",xt="_message-counter_1qbyb_19",Lt="_hidden_1qbyb_27",w={offline:bt,"unread-messages":"_unread-messages_1qbyb_8",unreadMessages:Ct,"message-counter":"_message-counter_1qbyb_19",messageCounter:xt,hidden:Lt},kt="data:image/svg+xml,%3csvg%20width='24'%20height='24'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%3e%3ctitle%3ebackground%3c/title%3e%3crect%20fill='none'%20id='canvas_background'%20height='402'%20width='582'%20y='-1'%20x='-1'/%3e%3c/g%3e%3cg%3e%3ctitle%3eLayer%201%3c/title%3e%3cg%20id='svg_1'%3e%3crect%20id='svg_2'%20fill='none'%20width='24'%20height='24'/%3e%3c/g%3e%3cg%20stroke='null'%20id='svg_3'%3e%3cg%20stroke='null'%20id='svg_4'%3e%3cpath%20stroke='null'%20id='svg_5'%20fill='hsl(0,%200%25,%2048%25)'%20d='m20,4.137689l0,12.826136l-14.83,0l-1.17,1.250548l0,-14.076684l16,0m0,-2.137689l-16,0c-1.1,0%20-2,0.96196%20-2,2.137689l0,16.663288c0,0.951272%201.08,1.432252%201.71,0.75888l2.29,-2.458343l14,0c1.1,0%202,-0.96196%202,-2.137689l0,-12.826136c0,-1.175729%20-0.9,-2.137689%20-2,-2.137689z'/%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/svg%3e",O={};class yt extends o{constructor(e,t){super();i(this,"element");this.element=document.createElement("li"),O.listItem&&this.addClass(O.listItem),e&&(this.textContent=e),t&&this.addClass(t)}}class St extends o{constructor(e,t){super();i(this,"element");i(this,"session",C.getSession());i(this,"user",this.session.user);i(this,"ws",g.getWS().ws);this.element=document.createElement("ul"),w.list&&this.addClass(w.list),t&&this.addClass(t),e.forEach(n=>{n!==this.user.login&&(this.session.addEntryToUnreadMessagesNumber(n),this.createNewItem(n),this.ws.send(JSON.stringify({id:String(p()),type:"MSG_FROM_USER",payload:{user:{login:n}}})))})}createNewItem(e,t){const n=new yt;n.id=e;const a=new o(w.textBlock,"span",e),d=new o(w.unreadMessages),h=new o(w.messageCounter);n.appendChild(a),d.appendChildren(h,new k(kt)),d.addClass(w.hidden),n.appendChild(d),t?(n.addClass(w.offline),this.appendChild(n)):this.prepend(n)}filter(e){this.children.forEach(t=>{t.textContent.includes(e)&&!this.node.contains(t.node)&&(t.node.classList.contains(w.offline)?this.node.appendChild(t.node):this.node.prepend(t.node)),t.textContent.includes(e)||this.node.contains(t.node)&&this.node.removeChild(t.node)})}addOfflineUsers(e){e.forEach(t=>{this.createNewItem(t,!0),this.ws.send(JSON.stringify({id:String(p()),type:"MSG_FROM_USER",payload:{user:{login:t}}}))})}setUserOnline(e){let t=!0;this.children.forEach(n=>{n.id===e&&(n.removeClass(w.offline),t=!1)}),t&&this.createNewItem(e)}setUserOffline(e){let t=!0;this.children.forEach(n=>{n.id===e&&(n.addClass(w.offline),t=!1)}),t&&this.createNewItem(e,!0)}updateUnreadMessagesNumber(e){const t=this.session.getUnreadMessagesNumber(e)||0,n=document.getElementById(e);if(n){const a=n.lastElementChild,d=a.firstChild;d.textContent=t.toString(),t?a.classList.remove(w.hidden):(a.classList.add(w.hidden),this.session.isThereUnread=!1)}}}const It="data:image/svg+xml,%3csvg%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M16%206L5%2017L1%2013'%20stroke='hsl(96,%2016%25,%2064%25)'%20stroke-width='2'%20stroke-linecap='round'/%3e%3c/svg%3e",Bt="data:image/svg+xml,%3csvg%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M12%2017L11.2929%2017.7071L12%2018.4142L12.7071%2017.7071L12%2017ZM23.7071%206.70711C24.0976%206.31658%2024.0976%205.68342%2023.7071%205.29289C23.3166%204.90237%2022.6834%204.90237%2022.2929%205.29289L23.7071%206.70711ZM5%2017L4.29289%2017.7071L5%2018.4142L5.70711%2017.7071L5%2017ZM16.7071%206.70711C17.0976%206.31658%2017.0976%205.68342%2016.7071%205.29289C16.3166%204.90237%2015.6834%204.90237%2015.2929%205.29289L16.7071%206.70711ZM1.70711%2012.2929C1.31658%2011.9024%200.683418%2011.9024%200.292893%2012.2929C-0.0976311%2012.6834%20-0.0976311%2013.3166%200.292893%2013.7071L1.70711%2012.2929ZM12.7071%2017.7071L23.7071%206.70711L22.2929%205.29289L11.2929%2016.2929L12.7071%2017.7071ZM9.29289%2015.7071L11.2929%2017.7071L12.7071%2016.2929L10.7071%2014.2929L9.29289%2015.7071ZM5.70711%2017.7071L16.7071%206.70711L15.2929%205.29289L4.29289%2016.2929L5.70711%2017.7071ZM0.292893%2013.7071L4.29289%2017.7071L5.70711%2016.2929L1.70711%2012.2929L0.292893%2013.7071Z'%20fill='hsl(96,%2016%25,%2064%25)'/%3e%3c/svg%3e",Nt="data:image/svg+xml,%3csvg%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M12%2017L11.2929%2017.7071L12%2018.4142L12.7071%2017.7071L12%2017ZM23.7071%206.70711C24.0976%206.31658%2024.0976%205.68342%2023.7071%205.29289C23.3166%204.90237%2022.6834%204.90237%2022.2929%205.29289L23.7071%206.70711ZM5%2017L4.29289%2017.7071L5%2018.4142L5.70711%2017.7071L5%2017ZM16.7071%206.70711C17.0976%206.31658%2017.0976%205.68342%2016.7071%205.29289C16.3166%204.90237%2015.6834%204.90237%2015.2929%205.29289L16.7071%206.70711ZM1.70711%2012.2929C1.31658%2011.9024%200.683418%2011.9024%200.292893%2012.2929C-0.0976311%2012.6834%20-0.0976311%2013.3166%200.292893%2013.7071L1.70711%2012.2929ZM12.7071%2017.7071L23.7071%206.70711L22.2929%205.29289L11.2929%2016.2929L12.7071%2017.7071ZM9.29289%2015.7071L11.2929%2017.7071L12.7071%2016.2929L10.7071%2014.2929L9.29289%2015.7071ZM5.70711%2017.7071L16.7071%206.70711L15.2929%205.29289L4.29289%2016.2929L5.70711%2017.7071ZM0.292893%2013.7071L4.29289%2017.7071L5.70711%2016.2929L1.70711%2012.2929L0.292893%2013.7071Z'%20fill='hsl(240,%2056%25,%2064%25)'/%3e%3c/svg%3e",Et="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%200%2024%2024'%20width='24'%3e%3cpath%20d='M0%200h24v24H0V0z'%20fill='none'/%3e%3cpath%20d='M3%2017.46v3.04c0%20.28.22.5.5.5h3.04c.13%200%20.26-.05.35-.15L17.81%209.94l-3.75-3.75L3.15%2017.1c-.1.1-.15.22-.15.36zM20.71%207.04c.39-.39.39-1.02%200-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41%200l-1.83%201.83%203.75%203.75%201.83-1.83z'/%3e%3c/svg%3e",Tt="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%200%2024%2024'%20width='24'%3e%3cpath%20d='M0%200h24v24H0V0z'%20fill='none'/%3e%3cpath%20d='M6%2019c0%201.1.9%202%202%202h8c1.1%200%202-.9%202-2V9c0-1.1-.9-2-2-2H8c-1.1%200-2%20.9-2%202v10zM9%209h6c.55%200%201%20.45%201%201v8c0%20.55-.45%201-1%201H9c-.55%200-1-.45-1-1v-8c0-.55.45-1%201-1zm6.5-5l-.71-.71c-.18-.18-.44-.29-.7-.29H9.91c-.26%200-.52.11-.7.29L8.5%204H6c-.55%200-1%20.45-1%201s.45%201%201%201h12c.55%200%201-.45%201-1s-.45-1-1-1h-2.5z'/%3e%3c/svg%3e";class Rt extends o{constructor(e,t=!1){super(u.messageWrapper);i(this,"from");i(this,"isReaded");i(this,"messageBlock",new o(u.messageBlock));i(this,"textBlock",new o(u.textBlock,"span"));i(this,"stateIcon",new k(It,u.stateIcon));i(this,"marker",new o(u.marker,"span","(edited)"));i(this,"contextMenu",new o(u.contextMenu));i(this,"editButton",new m(null,"button",Et));i(this,"deleteButton",new m(null,"button",Tt));i(this,"ws",g.getWS().ws);i(this,"returnButton",new m(null,"button",S));this.from=e.from,this.isReaded=e.status.isReaded,this.addClass(t?u.own:u.chatterer),this.id=e.id;const n=new o(u.title),a=new o(u.nickNameBlock,"div",e.from),d=new Date(e.datetime),h=new o(u.dateBlock,"div",`${d.toLocaleDateString()} ${d.toLocaleTimeString()}`);this.textBlock.textContent=e.text,t&&this.messageBlock.appendChild(this.stateIcon),this.setState(e.status,t),n.appendChildren(a,h),this.appendChildren(n),this.render(t),this.init(t)}render(e){this.messageBlock.prepend(this.textBlock),this.contextMenu.appendChildren(this.editButton,this.deleteButton,this.returnButton),this.appendChild(this.messageBlock),e&&this.appendChild(this.contextMenu)}init(e){this.stateIcon.setAttribute("align","right"),this.contextMenu.addClass(u.hidden),e&&this.addListener("contextmenu",t=>{t.preventDefault(),this.contextMenu.removeClass(u.hidden),this.returnButton.addListener("click",()=>{this.contextMenu.addClass(u.hidden)}),this.editButton.addClass("edit-message"),this.deleteButton.addListener("click",()=>{this.ws.send(JSON.stringify({id:String(p()),type:"MSG_DELETE",payload:{message:{id:this.id}}}))})})}setState(e,t){e.isDelivered&&t&&this.setDelivered(),e.isEdited&&this.setEdited(),e.isReaded&&t&&this.setReaded()}setDelivered(){this.stateIcon.setAttribute("src",Bt),this.messageBlock.appendChild(this.stateIcon)}setEdited(){this.messageBlock.appendChild(this.marker)}setReaded(){this.node.classList.contains(u.own)&&(this.stateIcon.setAttribute("src",Nt),this.messageBlock.appendChild(this.stateIcon))}handleVisible(e){const t={root:e.node,rootMargin:"1px",threshold:1},n=(d,h)=>{this.node.classList.contains(u.chatterer)&&d.forEach(_=>{_.isIntersecting&&(h.unobserve(_.target),this.ws.send(JSON.stringify({id:String(p()),type:"MSG_READ",payload:{message:{id:this.id}}})))})};new IntersectionObserver(n,t).observe(this.node)}getMessage(){return this.textBlock.textContent}setMessage(e){this.textBlock.textContent=e}hideContextMenu(){this.contextMenu.addClass(u.hidden)}getFrom(){return this.from}isRead(){return this.isReaded}}const At="_modal-window_1ffrg_1",Ut="_message-box_1ffrg_47",Wt="_return-button_1ffrg_52",E={"modal-window":"_modal-window_1ffrg_1",modalWindow:At,"message-box":"_message-box_1ffrg_47",messageBox:Ut,"return-button":"_return-button_1ffrg_52",returnButton:Wt};class H extends o{constructor(e,t){super();i(this,"element");i(this,"returnButton",new m(()=>{this.close()},"button",S,E.returnButton));i(this,"messageBox",new o(E.messageBox));this.element=document.createElement("dialog"),e&&(this.messageBox.textContent=e),t&&this.open(),this.addClass(E.modalWindow),this.appendChildren(this.messageBox,this.returnButton)}open(){this.setAttribute("open")}close(){this.element.close()}setMessage(e){this.textContent=e}}const Ot="_popup-window_p19yl_1",Pt="_inner_p19yl_29",qt="_icon_p19yl_43",Vt="_message-box_p19yl_61",zt="_return-button_p19yl_66",I={"popup-window":"_popup-window_p19yl_1",popupWindow:Ot,inner:Pt,icon:qt,"message-box":"_message-box_p19yl_61",messageBox:Vt,"return-button":"_return-button_p19yl_66",returnButton:zt},$t="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20200%20200'%3e%3cradialGradient%20id='a1'%20cx='.66'%20fx='.66'%20cy='.3125'%20fy='.3125'%20gradientTransform='scale(1.5)'%3e%3cstop%20offset='0'%20stop-color='%23aee58a'%3e%3c/stop%3e%3cstop%20offset='.3'%20stop-color='%23aee58a'%20stop-opacity='.9'%3e%3c/stop%3e%3cstop%20offset='.6'%20stop-color='%23aee58a'%20stop-opacity='.6'%3e%3c/stop%3e%3cstop%20offset='.8'%20stop-color='%23aee58a'%20stop-opacity='.3'%3e%3c/stop%3e%3cstop%20offset='1'%20stop-color='%23aee58a'%20stop-opacity='0'%3e%3c/stop%3e%3c/radialGradient%3e%3ccircle%20transform-origin='center'%20fill='none'%20stroke='url(%23a1)'%20stroke-width='15'%20stroke-linecap='round'%20stroke-dasharray='200%201000'%20stroke-dashoffset='0'%20cx='100'%20cy='100'%20r='70'%3e%3canimateTransform%20type='rotate'%20attributeName='transform'%20calcMode='spline'%20dur='2.4'%20values='360;0'%20keyTimes='0;1'%20keySplines='0%200%201%201'%20repeatCount='indefinite'%3e%3c/animateTransform%3e%3c/circle%3e%3ccircle%20transform-origin='center'%20fill='none'%20opacity='.2'%20stroke='%23aee58a'%20stroke-width='15'%20stroke-linecap='round'%20cx='100'%20cy='100'%20r='70'%3e%3c/circle%3e%3c/svg%3e";class jt extends o{constructor(e,t){super();i(this,"element");i(this,"icon",new k($t,I.icon));i(this,"messageBox",new o(I.messageBox));this.element=document.createElement("dialog");const n=new o(I.inner);n.appendChildren(this.messageBox,this.icon),e&&(this.messageBox.textContent=e),t&&this.open(),this.addClass(I.popupWindow),this.appendChild(n)}open(){this.setAttribute("open")}close(){this.element.close()}setMessage(e){this.textContent=e}}const P="Select a user in the side bar to send a message...",Ht="Write and send your first message using the form below...";class Dt extends o{constructor(){super(l.ChatPage);i(this,"ws",g.getWS().ws);i(this,"session",C.getSession());i(this,"state","");i(this,"reconnectIntervalId",null);i(this,"user",this.session.user);i(this,"userList",null);i(this,"popupWindow",new jt("Connection lost! Trying to restore it..."));i(this,"sideBar",new o(l.sideBar,"aside"));i(this,"searchInput",new A("Find user...",l.searchInput));i(this,"hintMessage",new o(l.hintMessage,"div",P));i(this,"nickNameBlock",new o(l.nickName));i(this,"chattererStatusBlock",new o(l.chattererStatus));i(this,"sendMessageForm",new o(l.sendMessage,"form"));i(this,"sendMessageInput",new A("Message...",l.sendMessageInput));i(this,"sendMessageButton",new m(null,"submit",Ke,l.lowButton));i(this,"cancelEditButton",new m(null,"button",Xe,l.cancelEditButton));i(this,"chattererName","");i(this,"chatWrapper",new o(l.chatWrapper));i(this,"divider",new o(l.divider));i(this,"header",null);i(this,"sendMessage",()=>{this.sendMessageInput.value.trim().length&&this.chattererName.length&&(this.ws.send(JSON.stringify({id:String(p()),type:"MSG_SEND",payload:{message:{to:this.chattererName,text:this.sendMessageInput.value}}})),this.session.setAllMessagesAsRead()),this.sendMessageInput.value=""});i(this,"finishEditMessage",()=>{this.cancelEditButton.addClass(l.hidden),this.sendMessageInput.value="",this.sendMessageButton.node.onclick=this.sendMessage});this.init(),this.render(this.user.login)}render(e){this.header=new at(e);const t=new o(l.chat,"main"),n=new o(l.chatSection,"section"),a=new o(l.chatTitle),d=new m(()=>{this.sideBar.addClass(l.visible)},"button",S,l.lowButton,l.returnButton);this.sendMessageForm.appendChildren(this.sendMessageInput,this.sendMessageButton),a.appendChildren(this.nickNameBlock,this.chattererStatusBlock,d),this.chatWrapper.appendChildren(this.hintMessage),n.appendChildren(this.sendMessageForm,a,this.chatWrapper),t.appendChildren(this.sideBar,n);const h=new ft;this.appendChildren(this.header,t,h)}init(){this.ws.send(JSON.stringify({id:String(p()),type:"USER_ACTIVE",payload:null})),this.addOnMessageHandlers(),this.addOnCloseHandler(),this.session.clearUnreadMessagesNumber(),this.session.clearSendMessages();const e=new o(l.dividerText,"span","new messages");this.divider.appendChild(e),this.sendMessageForm.addListener("submit",t=>{t.preventDefault()}),this.chatWrapper.addListener("scroll",()=>{this.session.iterateMessages(t=>{this.session.getScrollMode()==="manual"&&(t.handleVisible(this.chatWrapper),this.divider.removeNode())})}),this.chatWrapper.addListener("click",t=>{this.divider.removeNode(),this.session.setAllMessagesAsRead();const n=t.target;if(n.closest(".edit-message")){const a=n.closest(".edit-message"),d=a==null?void 0:a.closest(`.${u.contextMenu}`),h=d==null?void 0:d.closest(`.${u.messageWrapper}`),_=h==null?void 0:h.id;this.editMessage(_)}}),this.cancelEditButton.node.onclick=this.finishEditMessage,this.sendMessageButton.node.onclick=this.sendMessage,this.sendMessageButton.addListener("click",()=>{this.divider.removeNode()}),this.sendMessageButton.setAttribute("disabled"),this.sendMessageInput.setAttribute("disabled"),this.cancelEditButton.addClass(l.hidden),this.sendMessageForm.appendChild(this.cancelEditButton)}addOnMessageHandlers(){this.ws.onmessage=e=>{var n,a,d,h,_;const t=JSON.parse(e.data);if(t.type==="USER_LOGIN"&&(this.user.isLogined&&this.ws.send(JSON.stringify({id:String(p()),type:"USER_ACTIVE",payload:null})),this.user.login=t.payload.user.login,t.payload.user.isLogined&&(window.location.hash="/main",this.user.isLogined=!0)),t.type==="ERROR"){const c=new H(`Error: ${t.payload.error}`,!0),{node:f}=c;document.body.append(f)}if(t.type==="USER_LOGOUT"&&(this.user.isLogined=!1,this.state="logout",window.location.hash="/login"),t.type==="USER_ACTIVE"&&this.createUsersList(t.payload.users.map(c=>c.login)),t.type==="USER_INACTIVE"&&this.userList.addOfflineUsers(t.payload.users.map(c=>c.login)),t.type==="MSG_FROM_USER"&&(t.payload.messages.length&&this.state==="startChat"?(this.createCorrespondence(t.payload.messages),this.state="chat"):this.state==="startChat"?(this.hintMessage.textContent=Ht,this.hintMessage.removeClass(l.hidden),this.chatWrapper.appendChild(this.hintMessage)):this.updateUnreadMessagesNumber(t.payload.messages)),t.type==="USER_EXTERNAL_LOGIN"&&((n=this.userList)==null||n.setUserOnline(t.payload.user.login),this.nickNameBlock.textContent===t.payload.user.login&&(this.chattererStatusBlock.textContent="online")),t.type==="USER_EXTERNAL_LOGOUT"&&((a=this.userList)==null||a.setUserOffline(t.payload.user.login),this.nickNameBlock.textContent===t.payload.user.login&&(this.chattererStatusBlock.textContent="offline")),t.type==="MSG_SEND"){const{message:c}=t.payload;this.createMessage(c),c.from!==this.user.login&&(this.session.incrementUnreadMessagesNumber(c.from),(d=this.userList)==null||d.updateUnreadMessagesNumber(c.from),this.session.putSendedMessage(c.id,c))}if(t.type==="MSG_DELIVER"&&this.session.getMessage(t.payload.message.id).setDelivered(),t.type==="MSG_READ"){const c=this.session.getMessage(t.payload.message.id);c==null||c.setReaded();const f=(c==null?void 0:c.getFrom())||"";this.session.decrementUnreadMessagesNumber(f),(h=this.userList)==null||h.updateUnreadMessagesNumber(f)}if(t.type==="MSG_DELETE"){const{id:c}=t.payload.message,f=this.session.getSendedMessage(c),U=(f==null?void 0:f.from)||"";this.session.deleteMessage(c),f!=null&&f.status.isReaded||(this.session.decrementUnreadMessagesNumber(U),(_=this.userList)==null||_.updateUnreadMessagesNumber(U))}if(t.type==="MSG_EDIT"){const c=this.session.getMessage(t.payload.message.id);c==null||c.setMessage(t.payload.message.text),c==null||c.setEdited()}}}addOnCloseHandler(){const{node:e}=this.popupWindow;this.ws.onclose=()=>{this.popupWindow.open(),document.body.appendChild(e);const t=()=>{g.getWS().repeatConnect(),g.getWS().ws.onopen=()=>{clearInterval(this.reconnectIntervalId),this.popupWindow.close(),this.ws.close(),g.getWS().repeatConnect(),this.ws=g.getWS().ws,this.ws.onopen=()=>{var n;this.header.setWS(this.ws),this.addOnMessageHandlers(),this.session.clearUnreadMessagesNumber(),this.session.clearMessages(),this.session.clearSendMessages(),this.chatWrapper.removeChildren(),this.hintMessage.textContent=P,this.chatWrapper.appendChild(this.hintMessage),this.hintMessage.removeClass(l.hidden),this.state="",this.nickNameBlock.textContent="",this.chattererStatusBlock.textContent="",this.sendMessageButton.setAttribute("disabled"),this.sendMessageInput.setAttribute("disabled"),(n=this.userList)==null||n.removeNode(),this.userList=null,this.ws.send(JSON.stringify({id:String(p()),type:"USER_LOGIN",payload:{user:{login:this.user.login,password:this.user.password}}}))}}};this.reconnectIntervalId=setInterval(t,1e3)}}createUsersList(e){this.userList=new St(e,l.userList),this.searchInput.addListener("input",()=>{this.userList.filter(this.searchInput.value)}),this.userList.addListener("click",t=>{var a,d;this.sideBar.removeClass(l.visible),this.sendMessageButton.removeAttribute("disabled"),this.sendMessageInput.removeAttribute("disabled"),this.session.clearMessages(),this.session.clearSendMessages(),this.chatWrapper.removeChildren(),this.chatWrapper.appendChild(this.hintMessage);const n=t.target;this.chattererName=((a=n.closest("li"))==null?void 0:a.firstChild.textContent)||"",this.nickNameBlock.textContent=this.chattererName,this.chattererStatusBlock.textContent=(d=n.closest("li"))!=null&&d.classList.value.includes("offline")?"offline":"online",this.state="startChat",this.ws.send(JSON.stringify({id:String(p()),type:"MSG_FROM_USER",payload:{user:{login:this.chattererName}}}))}),this.sideBar.appendChildren(this.searchInput,this.userList),this.ws.send(JSON.stringify({id:String(p()),type:"USER_INACTIVE",payload:null}))}updateUnreadMessagesNumber(e){var t;if(e.length){let n="";e.forEach(a=>{a.from!==this.user.login&&!a.status.isReaded&&(this.session.incrementUnreadMessagesNumber(a.from),n=a.from)}),n&&((t=this.userList)==null||t.updateUnreadMessagesNumber(n))}}createCorrespondence(e){e.length&&e.forEach(t=>this.createMessage(t))}createMessage(e){const t=this.user.login===e.from;if(e.from===this.chattererName||t){this.hintMessage.addClass(l.hidden);const n=new Rt(e,t);this.session.putMessage(e.id,n),!e.status.isReaded&&!this.session.isThereUnread&&!t&&(this.session.isThereUnread=!0,this.chatWrapper.appendChild(this.divider)),this.chatWrapper.appendChild(n),this.session.isThereUnread?this.scrollToDivider():this.scrollToEnd()}}editMessage(e){const t=this.session.getMessage(e),n=()=>{this.finishEditMessage(),t==null||t.returnButton.removeListener("click",n)};t==null||t.returnButton.addListener("click",n),this.sendMessageInput.value=t==null?void 0:t.getMessage(),t==null||t.hideContextMenu(),this.cancelEditButton.removeClass(l.hidden),this.sendMessageInput.node.focus(),this.sendMessageButton.node.onclick=()=>{this.sendMessageInput.value.length&&(this.ws.send(JSON.stringify({id:String(p()),type:"MSG_EDIT",payload:{message:{id:e,text:this.sendMessageInput.value}}})),this.finishEditMessage())}}scrollToEnd(){this.session.setScrollModeToAuto(),this.chatWrapper.node.scrollTop=this.chatWrapper.node.scrollHeight,setTimeout(()=>{this.session.setScrollModeToManual()},800)}scrollToDivider(){this.session.setScrollModeToAuto();const e=this.chatWrapper.node.getBoundingClientRect(),n=this.divider.node.getBoundingClientRect().top-e.top;this.chatWrapper.node.scrollTop+=n,setTimeout(()=>{this.session.setScrollModeToManual()},800)}getState(){return this.state}}const Gt="_main_abkt9_1",Ft={main:Gt},Zt="_login-form_19ttn_1",Jt="_about-link_19ttn_9",Kt="_hidden_19ttn_18",Xt="_tooltip_19ttn_25",Yt="_buttons-wrapper_19ttn_33",L={"login-form":"_login-form_19ttn_1",loginForm:Zt,"about-link":"_about-link_19ttn_9",aboutLink:Jt,hidden:Kt,tooltip:Xt,"buttons-wrapper":"_buttons-wrapper_19ttn_33",buttonsWrapper:Yt},Qt="_fieldset_1vaeb_1",es={fieldset:Qt};class ts extends o{constructor(e){super();i(this,"legend");i(this,"element");this.element=document.createElement("fieldset"),this.addClass(es.fieldset),e&&(this.legend=new o("","legend",e),this.appendChild(this.legend))}}const ss="_label_148u2_1",ns="_tooltip_148u2_8",is={label:ss,tooltip:ns},os="_password-input_11kwa_1",as="_invalid_11kwa_11",T={"password-input":"_password-input_11kwa_1",passwordInput:os,invalid:as};class rs extends j{constructor(s){super(T.passwordInput),this.setAttribute("type","password"),s&&this.setAttribute("placeholder",s)}setInvalid(){this.addClass(T.invalid)}setValid(){this.removeClass(T.invalid)}}class q extends o{constructor(e,t,n){super();i(this,"input");i(this,"element");this.element=document.createElement("label"),this.textContent=e,this.addClass(is.label),this.input=t==="text"?new A(n):new rs(n),this.appendChild(this.input)}get value(){return this.input.value}set value(e){this.input.value=e}setInvalid(){this.input.setInvalid()}setValid(){this.input.setValid()}}const ds="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20enable-background='new%200%200%2024%2024'%20height='24'%20viewBox='0%200%2024%2024'%20width='24'%3e%3cg%3e%3crect%20fill='none'%20height='24'%20width='24'/%3e%3crect%20fill='none'%20height='24'%20width='24'/%3e%3c/g%3e%3cg%3e%3cpath%20d='M10.3,7.7L10.3,7.7c-0.39,0.39-0.39,1.01,0,1.4l1.9,1.9H3c-0.55,0-1,0.45-1,1v0c0,0.55,0.45,1,1,1h9.2l-1.9,1.9%20c-0.39,0.39-0.39,1.01,0,1.4l0,0c0.39,0.39,1.01,0.39,1.4,0l3.59-3.59c0.39-0.39,0.39-1.02,0-1.41L11.7,7.7%20C11.31,7.31,10.69,7.31,10.3,7.7z%20M20,19h-7c-0.55,0-1,0.45-1,1v0c0,0.55,0.45,1,1,1h7c1.1,0,2-0.9,2-2V5c0-1.1-0.9-2-2-2h-7%20c-0.55,0-1,0.45-1,1v0c0,0.55,0.45,1,1,1h7V19z'/%3e%3c/g%3e%3c/svg%3e",cs="The name must be in English letters, starting with capital.",ls="Minimum name length - 2 and maximum - 12 characters.",hs="Minimum password length - 4 characters.",us="Must contain at least 1 English letter and 1 number.";class ps extends o{constructor(){super();i(this,"fieldset",new ts("Authorization"));i(this,"nameInput",new q("Name","text","Enter your name"));i(this,"passwordInput",new q("Password","password","Enter password"));i(this,"firstRuleNameTooltip",new o(L.tooltip));i(this,"secondRuleNameTooltip",new o(L.tooltip));i(this,"firstRulePasswordTooltip",new o(L.tooltip));i(this,"secondRulePasswordTooltip",new o(L.tooltip));i(this,"loginButton",new m(null,"submit",ds,"","login-button"));i(this,"infoButton",new m(()=>{window.location.hash="/about"},"button",$));i(this,"isNameValid",!1);i(this,"isPasswordValid",!1);i(this,"user",C.getSession().user);i(this,"element");this.element=document.createElement("form"),this.addClass(L.loginForm),this.init(),this.render()}render(){this.fieldset.appendChildren(this.nameInput,this.firstRuleNameTooltip,this.secondRuleNameTooltip,this.passwordInput,this.firstRulePasswordTooltip,this.secondRulePasswordTooltip);const e=new o(L.buttonsWrapper);e.appendChildren(this.loginButton,this.infoButton),this.appendChildren(this.fieldset,e)}init(){this.addListener("submit",e=>{e.preventDefault()}),this.loginButton.disable(),this.loginButton.addListener("click",()=>{this.user.password=this.passwordInput.value,g.getWS().ws.send(JSON.stringify({id:String(p()),type:"USER_LOGIN",payload:{user:{login:`${this.nameInput.value}`,password:`${this.passwordInput.value}`}}}))}),this.nameInput.addListener("input",()=>{this.validateName()}),this.passwordInput.addListener("input",()=>{this.validatePassword()}),this.addListener("input",()=>{this.isNameValid&&this.isPasswordValid?this.loginButton.enable():this.loginButton.disable()})}validateName(){let e=!1;/^[A-Z][a-zA-Z]*$/.test(this.nameInput.value)?(this.firstRuleNameTooltip.textContent="",e=!0):(this.firstRuleNameTooltip.textContent=cs,this.nameInput.setInvalid(),this.loginButton.disable()),/.{2,12}/.test(this.nameInput.value)?(this.secondRuleNameTooltip.textContent="",e&&(e=!0)):(this.secondRuleNameTooltip.textContent=ls,this.nameInput.setInvalid(),this.loginButton.disable(),e=!1),e&&(this.nameInput.setValid(),this.isNameValid=!0),this.isNameValid=e}validatePassword(){let e=!1;/.{4,}/.test(this.passwordInput.value)?(this.firstRulePasswordTooltip.textContent="",e=!0):(this.firstRulePasswordTooltip.textContent=hs,this.passwordInput.setInvalid(),this.loginButton.disable()),/^(?=.*[a-zA-Z])(?=.*\d).+/.test(this.passwordInput.value)?(this.secondRulePasswordTooltip.textContent="",e&&(e=!0)):(this.secondRulePasswordTooltip.textContent=us,this.passwordInput.setInvalid(),this.loginButton.disable(),e=!1),e&&this.passwordInput.setValid(),this.isPasswordValid=e}}class V extends o{constructor(){super(Ft.main,"main"),this.appendChild(new ps)}}const gs="ws://127.0.0.1:4000/";class ms extends o{constructor(e){super(e);i(this,"user",C.getSession().user);i(this,"chatPage",null);this.init()}init(){const{ws:e}=g.getWS(gs);e.onmessage=n=>{const a=JSON.parse(n.data);a.type==="USER_LOGIN"&&(this.user.login=a.payload.user.login,a.payload.user.isLogined&&(window.location.hash="/main",this.user.isLogined=!0)),a.type==="ERROR"&&this.appendChild(new H(`Error: ${a.payload.error}`,!0))};let t=window.location.hash.slice(2);t?this.renderNewPage(t):(window.location.hash="#/",this.renderNewPage("")),window.onhashchange=()=>{t=window.location.hash.slice(2),this.renderNewPage(t)}}renderNewPage(e){switch(this.removeChildren(),e){case"":this.appendChild(new V);break;case"login":this.user.isLogined?window.location.hash="/main":this.appendChild(new V);break;case"main":this.user.isLogined?(this.chatPage&&this.chatPage.getState()==="logout"&&(this.chatPage=null),this.chatPage||(this.chatPage=new Dt),this.appendChild(this.chatPage)):(this.chatPage=null,window.location.hash="/login");break;case"about":this.appendChild(new we);break;default:this.appendChild(new oe);break}}}const _s=new ms("app-container");document.body.appendChild(_s.node);
