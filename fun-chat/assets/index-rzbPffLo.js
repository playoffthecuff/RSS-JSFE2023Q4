var D=Object.defineProperty;var H=(d,t,e)=>t in d?D(d,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[t]=e;var i=(d,t,e)=>(H(d,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(n){if(n.ep)return;n.ep=!0;const a=e(n);fetch(n.href,a)}})();const G="_main_1d7em_1",F="_error-msg_1d7em_12",Z="_no-page-msg_1d7em_16",y={main:G,"error-msg":"_error-msg_1d7em_12",errorMsg:F,"no-page-msg":"_no-page-msg_1d7em_16",noPageMsg:Z},B="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20enable-background='new%200%200%2024%2024'%20height='24'%20viewBox='0%200%2024%2024'%20width='24'%3e%3crect%20fill='none'%20height='24'%20width='24'/%3e%3cg%3e%3cpath%20d='M16.88,2.88L16.88,2.88c-0.49-0.49-1.28-0.49-1.77,0l-8.41,8.41c-0.39,0.39-0.39,1.02,0,1.41l8.41,8.41%20c0.49,0.49,1.28,0.49,1.77,0l0,0c0.49-0.49,0.49-1.28,0-1.77L9.54,12l7.35-7.35C17.37,4.16,17.37,3.37,16.88,2.88z'/%3e%3c/g%3e%3c/svg%3e";class o{constructor(t,e="div",s){i(this,"childrenArr");i(this,"element");this.element=document.createElement(e),t&&this.addClass(t),s&&(this.textContent=s),this.childrenArr=[]}get node(){return this.element}get children(){return this.childrenArr}get textContent(){return this.element.textContent||""}set textContent(t){this.element.textContent=t}get id(){return this.node.id}set id(t){this.node.id=t}appendChild(t){this.children.push(t),this.node.appendChild(t.node)}appendChildren(...t){t.forEach(e=>{this.appendChild(e)})}prepend(t){this.children.push(t),this.node.prepend(t.node)}removeChildren(){this.children.length=0,this.node.innerHTML=""}removeNode(){this.node.remove()}removeSelf(){this.removeChildren(),this.removeNode()}setStyle(t,e){const s=t;this.node.style.setProperty(s,e)}setAttribute(t,e){this.node.setAttribute(t,e||"")}removeAttribute(t){this.node.removeAttribute(t)}addClass(t){this.node.classList.contains(t)||this.node.classList.add(t)}toggleClass(t){this.node.classList.toggle(t)}removeClass(t){this.node.classList.remove(t)}addClassToChildren(t){this.children.forEach(e=>e.addClass(t))}removeClassFromChildren(t){this.children.forEach(e=>e.removeClass(t))}addClassToChild(t,e){this.children[t]&&this.children[t].addClass(e)}removeClassFromChild(t,e){this.children[t]&&this.children[t].removeClass(e)}addListener(t,e){this.node.addEventListener(t,e)}removeListener(t,e){this.node.removeEventListener(t,e)}}const J="_heading_1q6e1_1",K={heading:J};class C extends o{constructor(e,s,n){super();i(this,"element");this.element=document.createElement(e),this.addClass(K.heading),n&&this.addClass(n),this.textContent=s}}const X="_button_rm83u_1",Y="_hidden_rm83u_15",Q={button:X,hidden:Y},ee="_icon_1g5nx_1",te="_hidden_1g5nx_5",se={icon:ee,hidden:te};class I extends o{constructor(e,s,n){super();i(this,"element");this.element=document.createElement("img"),s?this.addClass(s):this.addClass(se.icon),this.node.setAttribute("src",e),n&&this.node.setAttribute("alt",n)}}class p extends o{constructor(e,s="button",n,a,r,u,m){super();i(this,"element");this.element=document.createElement("button"),this.addClass(Q.button),e&&this.addListener("click",e),s&&this.setAttribute("type",s),a&&this.addClass(a),r&&(this.node.id=r),m&&(this.node.textContent=m),n&&this.appendChild(new I(n,u||""))}disable(){this.setAttribute("disabled")}enable(){this.removeAttribute("disabled")}}const ne="An error occurred:",ie="the page you requested does not exist.";class ae extends o{constructor(){super(y.main,"main"),this.render()}render(){const t=new C("h1",ne,y.errorMsg),e=new C("h2",ie,y.noPageMsg),s=new p(()=>{window.history.back()},"button",B);this.appendChildren(t,e,s)}}const oe="_main_5we50_1",re="_about-wrapper_5we50_11",de="_app-name_5we50_18",ce="_article_5we50_26",le="_inline-icon_5we50_30",x={main:oe,"about-wrapper":"_about-wrapper_5we50_11",aboutWrapper:re,"app-name":"_app-name_5we50_18",appName:de,article:ce,"inline-icon":"_inline-icon_5we50_30",inlineIcon:le},z="data:image/svg+xml,%3csvg%20width='98'%20height='96'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M48.854%200C21.839%200%200%2022%200%2049.217c0%2021.756%2013.993%2040.172%2033.405%2046.69%202.427.49%203.316-1.059%203.316-2.362%200-1.141-.08-5.052-.08-9.127-13.59%202.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015%204.934.326%207.523%205.052%207.523%205.052%204.367%207.496%2011.404%205.378%2014.235%204.074.404-3.178%201.699-5.378%203.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283%200-5.378%201.94-9.778%205.014-13.2-.485-1.222-2.184-6.275.486-13.038%200%200%204.125-1.304%2013.426%205.052a46.97%2046.97%200%200%201%2012.214-1.63c4.125%200%208.33.571%2012.213%201.63%209.302-6.356%2013.427-5.052%2013.427-5.052%202.67%206.763.97%2011.816.485%2013.038%203.155%203.422%205.015%207.822%205.015%2013.2%200%2018.905-11.404%2023.06-22.324%2024.283%201.78%201.548%203.316%204.481%203.316%209.126%200%206.6-.08%2011.897-.08%2013.526%200%201.304.89%202.853%203.316%202.364%2019.412-6.52%2033.405-24.935%2033.405-46.691C97.707%2022%2075.788%200%2048.854%200z'%20fill='%23aee58a'/%3e%3c/svg%3e",he="_icon-link_1jgus_1",ue="_hidden_1jgus_13",pe="_icon_1jgus_1",U={"icon-link":"_icon-link_1jgus_1",iconLink:he,hidden:ue,icon:pe};class R extends o{constructor(e,s,n,a,r=U.iconLink,u=!0){super();i(this,"icon");i(this,"element");this.element=document.createElement("a"),this.addClass(U.iconLink),r&&this.addClass(r),this.setAttribute("href",e),a&&(this.node.textContent=a),s&&(this.icon=new I(s,n||""),this.appendChild(this.icon)),u&&this.setAttribute("target","_blank")}}const ge="Have a nice chat.<br>App by ",_e="https://github.com/rolling-scopes-school/playoffthecuff-JSFE2023Q4/";class me extends o{constructor(){super(x.main,"main"),this.render()}render(){const t=new o(x.aboutWrapper),e=new C("h1","Fun Chat",x.appName),s=new o(x.article,"article"),n=new R(_e,z,void 0,void 0,x.inlineIcon),a=new p(()=>{window.history.back()},"button",B);s.node.innerHTML=ge,s.appendChild(n),t.appendChildren(e,s,a),this.appendChild(t)}}const we="_chat_46lj4_1",fe="_chat-page_46lj4_7",ve="_chat-section_46lj4_11",Ce="_chat-wrapper_46lj4_25",be="_hint-message_46lj4_50",Me="_hidden_46lj4_58",Le="_chat-title_46lj4_62",xe="_nick-name_46lj4_72",ke="_chatterer-status_46lj4_78",Be="_send-message_46lj4_83",Ie="_send-message-input_46lj4_93",ye="_low-button_46lj4_98",Se="_return-button_46lj4_1",Ne="_user-list_46lj4_118",Ee="_side-bar_46lj4_161",Re="_visible_46lj4_174",Te="_search-input_46lj4_185",Ae="_divider_46lj4_189",Ue="_divider-text_46lj4_202",Pe="_cancel-edit-button_46lj4_211",c={chat:we,"chat-page":"_chat-page_46lj4_7",chatPage:fe,"chat-section":"_chat-section_46lj4_11",chatSection:ve,"chat-wrapper":"_chat-wrapper_46lj4_25",chatWrapper:Ce,"hint-message":"_hint-message_46lj4_50",hintMessage:be,hidden:Me,"chat-title":"_chat-title_46lj4_62",chatTitle:Le,"nick-name":"_nick-name_46lj4_72",nickName:xe,"chatterer-status":"_chatterer-status_46lj4_78",chattererStatus:ke,"send-message":"_send-message_46lj4_83",sendMessage:Be,"send-message-input":"_send-message-input_46lj4_93",sendMessageInput:Ie,"low-button":"_low-button_46lj4_98",lowButton:ye,"return-button":"_return-button_46lj4_1",returnButton:Se,"user-list":"_user-list_46lj4_118",userList:Ne,"side-bar":"_side-bar_46lj4_161",sideBar:Ee,visible:Re,"search-input":"_search-input_46lj4_185",searchInput:Te,divider:Ae,"divider-text":"_divider-text_46lj4_202",dividerText:Ue,"cancel-edit-button":"_cancel-edit-button_46lj4_211",cancelEditButton:Pe},qe="_message-wrapper_855ce_1",Oe="_context-menu_855ce_10",Ve="_hidden_855ce_24",ze="_title_855ce_29",We="_nick-name-block_855ce_37",$e="_date-block_855ce_41",je="_message-block_855ce_46",De="_text-block_855ce_51",He="_state-icon_855ce_61",Ge="_state-block_855ce_67",Fe="_own_855ce_72",Ze="_chatterer_855ce_76",h={"message-wrapper":"_message-wrapper_855ce_1",messageWrapper:qe,"context-menu":"_context-menu_855ce_10",contextMenu:Oe,hidden:Ve,title:ze,"nick-name-block":"_nick-name-block_855ce_37",nickNameBlock:We,"date-block":"_date-block_855ce_41",dateBlock:$e,"message-block":"_message-block_855ce_46",messageBlock:je,"text-block":"_text-block_855ce_51",textBlock:De,"state-icon":"_state-icon_855ce_61",stateIcon:He,"state-block":"_state-block_855ce_67",stateBlock:Ge,own:Fe,chatterer:Ze},Je="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%200%2024%2024'%20width='24'%3e%3cpath%20d='M0%200h24v24H0V0z'%20fill='none'/%3e%3cpath%20d='M3.4%2020.4l17.45-7.48c.81-.35.81-1.49%200-1.84L3.4%203.6c-.66-.29-1.39.2-1.39.91L2%209.12c0%20.5.37.93.87.99L17%2012%202.87%2013.88c-.5.07-.87.5-.87%201l.01%204.61c0%20.71.73%201.2%201.39.91z'/%3e%3c/svg%3e",Ke="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%200%2024%2024'%20width='24'%3e%3cpath%20d='M0%200h24v24H0V0z'%20fill='none'/%3e%3cpath%20d='M13.89%208.7L12%2010.59%2010.11%208.7c-.39-.39-1.02-.39-1.41%200-.39.39-.39%201.02%200%201.41L10.59%2012%208.7%2013.89c-.39.39-.39%201.02%200%201.41.39.39%201.02.39%201.41%200L12%2013.41l1.89%201.89c.39.39%201.02.39%201.41%200%20.39-.39.39-1.02%200-1.41L13.41%2012l1.89-1.89c.39-.39.39-1.02%200-1.41-.39-.38-1.03-.38-1.41%200zM12%202C6.47%202%202%206.47%202%2012s4.47%2010%2010%2010%2010-4.47%2010-10S17.53%202%2012%202zm0%2018c-4.41%200-8-3.59-8-8s3.59-8%208-8%208%203.59%208%208-3.59%208-8%208z'/%3e%3c/svg%3e",Xe="_user-block_3k1et_10",Ye="_user-icon_3k1et_18",Qe="_user-name_3k1et_26",et="_control-panel_3k1et_33",tt="_app-name_3k1et_40",M={"user-block":"_user-block_3k1et_10",userBlock:Xe,"user-icon":"_user-icon_3k1et_18",userIcon:Ye,"user-name":"_user-name_3k1et_26",userName:Qe,"control-panel":"_control-panel_3k1et_33",controlPanel:et,"app-name":"_app-name_3k1et_40",appName:tt},st="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%200%2024%2024'%20width='24'%3e%3cpath%20d='M0%200h24v24H0V0z'%20fill='none'/%3e%3cpath%20d='M12%2012c2.21%200%204-1.79%204-4s-1.79-4-4-4-4%201.79-4%204%201.79%204%204%204zm0%202c-2.67%200-8%201.34-8%204v1c0%20.55.45%201%201%201h14c.55%200%201-.45%201-1v-1c0-2.66-5.33-4-8-4z'/%3e%3c/svg%3e",W="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%200%2024%2024'%20width='24'%3e%3cg%20fill='none'%3e%3cpath%20d='M0%200h24v24H0V0z'/%3e%3cpath%20d='M0%200h24v24H0V0z'%20opacity='.87'/%3e%3c/g%3e%3cpath%20d='M11%207h2v2h-2zm1%2010c.55%200%201-.45%201-1v-4c0-.55-.45-1-1-1s-1%20.45-1%201v4c0%20.55.45%201%201%201zm0-15C6.48%202%202%206.48%202%2012s4.48%2010%2010%2010%2010-4.48%2010-10S17.52%202%2012%202zm0%2018c-4.41%200-8-3.59-8-8s3.59-8%208-8%208%203.59%208%208-3.59%208-8%208z'/%3e%3c/svg%3e",nt="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20enable-background='new%200%200%2024%2024'%20height='24'%20viewBox='0%200%2024%2024'%20width='24'%3e%3cg%3e%3cpath%20d='M0,0h24v24H0V0z'%20fill='none'/%3e%3c/g%3e%3cg%3e%3cg%3e%3cpath%20d='M5,5h6c0.55,0,1-0.45,1-1v0c0-0.55-0.45-1-1-1H5C3.9,3,3,3.9,3,5v14c0,1.1,0.9,2,2,2h6c0.55,0,1-0.45,1-1v0%20c0-0.55-0.45-1-1-1H5V5z'/%3e%3cpath%20d='M20.65,11.65l-2.79-2.79C17.54,8.54,17,8.76,17,9.21V11h-7c-0.55,0-1,0.45-1,1v0c0,0.55,0.45,1,1,1h7v1.79%20c0,0.45,0.54,0.67,0.85,0.35l2.79-2.79C20.84,12.16,20.84,11.84,20.65,11.65z'/%3e%3c/g%3e%3c/g%3e%3c/svg%3e",f=class f{constructor(t){i(this,"wsConnection");this.wsConnection=new WebSocket(t)}static getWS(t){return f.instance||(f.instance=new f(t)),f.instance}get ws(){return this.wsConnection}};i(f,"instance");let w=f;const v=class v{constructor(t){i(this,"userData",{login:"",isLogined:!1,password:""});i(this,"unreadMessagesNumber",new Map);i(this,"messages",new Map);i(this,"isThereUnreadMessage",!1);this.userData.login=t}static getSession(t){return v.instance||(v.instance=new v(t||"JohnDoe")),v.instance}get user(){return this.userData}get isThereUnread(){return this.isThereUnreadMessage}set isThereUnread(t){this.isThereUnreadMessage=t}getMessage(t){return this.messages.get(t)}putMessage(t,e){this.messages.set(t,e)}deleteMessage(t){var e;(e=this.messages.get(t))==null||e.removeSelf(),this.messages.delete(t)}clearMessages(){this.messages.clear()}iterateMessages(t){this.messages.forEach(t)}addEntryToUnreadMessagesNumber(t){this.unreadMessagesNumber.set(t,0)}incrementUnreadMessagesNumber(t){const e=this.unreadMessagesNumber.get(t)||0;this.unreadMessagesNumber.set(t,e+1)}decrementUnreadMessagesNumber(t){if(t){const e=this.unreadMessagesNumber.get(t)||1;this.unreadMessagesNumber.set(t,e-1),console.log("непрочитанных ",this.unreadMessagesNumber.get(t))}}getUnreadMessagesNumber(t){return this.unreadMessagesNumber.get(t)}};i(v,"instance");let b=v;function it(){let d=0;return()=>{const t=d;return d+=1,t}}const _=it();class at extends o{constructor(e){super(M.header,"header");i(this,"ws",w.getWS().ws);i(this,"user",b.getSession().user);i(this,"infoButton",new p(()=>{console.log("меняю хэш при клике на инфо кнопку"),window.location.hash="/about"},"button",W));i(this,"logoutButton",new p(()=>{console.log("run logout button click handler"),this.ws.send(JSON.stringify({id:String(_()),type:"USER_LOGOUT",payload:{user:{login:this.user.login,password:this.user.password}}}))},"button",nt));this.render(e)}render(e){this.createUserBlock(e),this.createHeading(),this.createControlPanel()}createUserBlock(e){const s=new o(M.userBlock),n=new I(st,M.userIcon),a=new C("h3",e,M.userName);s.appendChildren(n,a),this.appendChild(s)}createHeading(){const e=new C("h1","Fun Chat",M.appName);this.appendChild(e)}createControlPanel(){const e=new o(M.controlPanel);e.appendChildren(this.infoButton,this.logoutButton),this.appendChild(e)}}const ot="_user-block_1f6i0_15",rt="_rss-icon_1f6i0_21",dt="_gh-icon_1f6i0_31",ct="_author-name_1f6i0_35",lt="_year_1f6i0_41",k={"user-block":"_user-block_1f6i0_15",userBlock:ot,"rss-icon":"_rss-icon_1f6i0_21",rssIcon:rt,"gh-icon":"_gh-icon_1f6i0_31",ghIcon:dt,"author-name":"_author-name_1f6i0_35",authorName:ct,year:lt},ht="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20552.85%20198.67'%3e%3ctitle%3ers_school%3c/title%3e%3cg%20data-name='Layer%202'%3e%3cg%20data-name='Layer%201'%3e%3cpath%20d='M275.36%2061.37l26.29-1.65q.86%206.41%203.48%209.76%204.28%205.43%2012.2%205.43%205.91%200%209.12-2.77a8.34%208.34%200%200%200%203.2-6.44%208.18%208.18%200%200%200-3-6.22q-3-2.74-14.15-5.19-18.18-4.08-25.93-10.86a21.84%2021.84%200%200%201-7.81-17.26%2023.44%2023.44%200%200%201%204-13%2026.47%2026.47%200%200%201%2012-9.64q8-3.51%2022-3.51%2017.14%200%2026.14%206.38t10.71%2020.28l-26.05%201.52q-1-6-4.36-8.78t-9.2-2.77c-3.21%200-5.63.69-7.25%202.05a6.25%206.25%200%200%200-2.44%205%205%205%200%200%200%202%203.84q1.95%201.77%209.27%203.3%2018.12%203.9%2026%207.9t11.4%209.91a25.12%2025.12%200%200%201%203.57%2013.24%2028.37%2028.37%200%200%201-4.75%2015.86%2029.83%2029.83%200%200%201-13.3%2011q-8.55%203.75-21.54%203.75-22.81%200-31.6-8.78t-10-22.35zM6.27%2091V1.53h46.06q12.81%200%2019.58%202.19a20.93%2020.93%200%200%201%2010.92%208.14A24.75%2024.75%200%200%201%2087%2026.35a24.8%2024.8%200%200%201-3.2%2012.84A24.91%2024.91%200%200%201%2075.07%2048a33.63%2033.63%200%200%201-9.7%203.54%2027.79%2027.79%200%200%201%207.19%203.29A27.79%2027.79%200%200%201%2077%2059.49%2035.16%2035.16%200%200%201%2080.85%2065l13.38%2026H63L48.24%2063.63q-2.81-5.31-5-6.9a11.63%2011.63%200%200%200-6.78-2.07H34V91zM34%2037.76h11.68A41%2041%200%200%200%2053%2036.54a7.3%207.3%200%200%200%204.48-2.81%208.24%208.24%200%200%200%201.74-5.18%208.23%208.23%200%200%200-2.75-6.65q-2.74-2.32-10.31-2.32H34zM0%20167.56l26.29-1.64q.86%206.41%203.48%209.76Q34%20181.11%2042%20181.11q5.91%200%209.12-2.78a8.34%208.34%200%200%200%203.2-6.44%208.2%208.2%200%200%200-3-6.22q-3-2.74-14.15-5.18-18.18-4.1-25.93-10.86a21.87%2021.87%200%200%201-7.81-17.27%2023.49%2023.49%200%200%201%204-13%2026.47%2026.47%200%200%201%2012-9.64q8-3.51%2022-3.51%2017.14%200%2026.14%206.38t10.71%2020.28l-26%201.53q-1-6-4.36-8.79t-9.19-2.74q-4.81%200-7.25%202a6.25%206.25%200%200%200-2.44%205%205%205%200%200%200%202%203.85q1.95%201.77%209.27%203.29%2018.12%203.9%2026%207.9t11.4%209.91a25.15%2025.15%200%200%201%203.57%2013.24%2028.35%2028.35%200%200%201-4.75%2015.86%2029.83%2029.83%200%200%201-13.3%2011q-8.55%203.75-21.54%203.75-22.81%200-31.6-8.78T0%20167.56zm163-7.01l24.22%207.32a44.72%2044.72%200%200%201-7.69%2017%2033.46%2033.46%200%200%201-13%2010.31q-7.78%203.47-19.8%203.47-14.58%200-23.82-4.23t-16-14.91q-6.72-10.67-6.71-27.31%200-22.18%2011.8-34.11t33.4-11.92q16.91%200%2026.57%206.84t14.36%2021l-24.4%205.43a21%2021%200%200%200-2.68-6%2016%2016%200%200%200-5.67-4.88%2016.31%2016.31%200%200%200-7.51-1.71q-9.39%200-14.39%207.56-3.8%205.61-3.79%2017.61%200%2014.86%204.52%2020.38t12.69%205.51q7.92%200%2012-4.45t5.9-12.91zm45.51-52.83h27.63V139h30.2v-31.28h27.75v89.43h-27.75V161h-30.2v36.18h-27.63zm102.78%2044.77q0-21.88%2012.2-34.1t34-12.2q22.32%200%2034.4%2012T404%20151.76q0%2015.69-5.28%2025.72a37.54%2037.54%200%200%201-15.25%2015.61q-10%205.58-24.86%205.58-15.12%200-25-4.82a37.59%2037.59%200%200%201-16.07-15.25q-6.26-10.42-6.25-26.11zm27.63.13q0%2013.55%205%2019.46t13.7%205.91q8.91%200%2013.79-5.79t4.88-20.8q0-12.63-5.1-18.46t-13.82-5.82A16.78%2016.78%200%200%200%20344%20133q-5.07%206-5.08%2019.62z'/%3e%3cpath%20d='M392.28%20152.49q0-21.88%2012.2-34.1t34-12.2q22.34%200%2034.41%2012t12.07%2033.58q0%2015.69-5.27%2025.72a37.6%2037.6%200%200%201-15.25%2015.61q-10%205.58-24.86%205.58-15.13%200-25-4.82a37.67%2037.67%200%200%201-16.08-15.25q-6.22-10.43-6.22-26.12zm27.64.13q0%2013.55%205%2019.46t13.72%205.92q8.91%200%2013.79-5.79t4.88-20.8q0-12.63-5.09-18.46t-13.82-5.82A16.77%2016.77%200%200%200%20425%20133q-5.09%206-5.08%2019.62z'/%3e%3cpath%20d='M482.08%20107.72h27.64v67.41h43.13v22h-70.77z'/%3e%3c/g%3e%3c/g%3e%3c/svg%3e",ut="https://rs.school/",pt="https://github.com/playoffthecuff",gt="evgenii";class _t extends o{constructor(){super(void 0,"footer"),this.render()}render(){this.createRSSLink(),this.createUserBlock(),this.createYear()}createRSSLink(){const t=new R(ut,ht,"","",k.rssIcon);this.appendChild(t)}createUserBlock(){const t=new o(k.userBlock),e=new R(pt,z,"","",k.ghIcon),s=new C("h3",gt,k.authorName);t.appendChildren(e,s),this.appendChild(t)}createYear(){const t=new C("h2",new Date().getFullYear().toString(),k.year);this.appendChild(t)}}const mt="_text-input_1a6ht_1",wt="_invalid_1a6ht_11",S={"text-input":"_text-input_1a6ht_1",textInput:mt,invalid:wt};class $ extends o{constructor(e){super();i(this,"element");this.element=document.createElement("input"),this.addClass(e)}get value(){return this.element.value}set value(e){this.element.value=e}}class T extends ${constructor(t,e){super(S.textInput),this.setAttribute("type","text"),t&&this.setAttribute("placeholder",t),e&&this.addClass(e)}setInvalid(){this.addClass(S.invalid)}setValid(){this.removeClass(S.invalid)}}const ft="_offline_1qbyb_1",vt="_unread-messages_1qbyb_8",Ct="_message-counter_1qbyb_19",bt="_hidden_1qbyb_27",g={offline:ft,"unread-messages":"_unread-messages_1qbyb_8",unreadMessages:vt,"message-counter":"_message-counter_1qbyb_19",messageCounter:Ct,hidden:bt},Mt="data:image/svg+xml,%3csvg%20width='24'%20height='24'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%3e%3ctitle%3ebackground%3c/title%3e%3crect%20fill='none'%20id='canvas_background'%20height='402'%20width='582'%20y='-1'%20x='-1'/%3e%3c/g%3e%3cg%3e%3ctitle%3eLayer%201%3c/title%3e%3cg%20id='svg_1'%3e%3crect%20id='svg_2'%20fill='none'%20width='24'%20height='24'/%3e%3c/g%3e%3cg%20stroke='null'%20id='svg_3'%3e%3cg%20stroke='null'%20id='svg_4'%3e%3cpath%20stroke='null'%20id='svg_5'%20fill='hsl(0,%200%25,%2048%25)'%20d='m20,4.137689l0,12.826136l-14.83,0l-1.17,1.250548l0,-14.076684l16,0m0,-2.137689l-16,0c-1.1,0%20-2,0.96196%20-2,2.137689l0,16.663288c0,0.951272%201.08,1.432252%201.71,0.75888l2.29,-2.458343l14,0c1.1,0%202,-0.96196%202,-2.137689l0,-12.826136c0,-1.175729%20-0.9,-2.137689%20-2,-2.137689z'/%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/svg%3e",P={};class Lt extends o{constructor(e,s){super();i(this,"element");this.element=document.createElement("li"),P.listItem&&this.addClass(P.listItem),e&&(this.textContent=e),s&&this.addClass(s)}}class xt extends o{constructor(e,s){super();i(this,"element");i(this,"session",b.getSession());i(this,"user",this.session.user);i(this,"ws",w.getWS().ws);this.element=document.createElement("ul"),g.list&&this.addClass(g.list),s&&this.addClass(s),e.forEach(n=>{n!==this.user.login&&(this.session.addEntryToUnreadMessagesNumber(n),this.createNewItem(n),this.ws.send(JSON.stringify({id:String(_()),type:"MSG_FROM_USER",payload:{user:{login:n}}})))})}createNewItem(e,s){const n=new Lt;n.id=e;const a=new o(g.textBlock,"span",e),r=new o(g.unreadMessages),u=new o(g.messageCounter);n.appendChild(a),r.appendChildren(u,new I(Mt)),r.addClass(g.hidden),n.appendChild(r),s?(n.addClass(g.offline),this.appendChild(n)):this.prepend(n)}filter(e){this.children.forEach(s=>{s.textContent.includes(e)&&!this.node.contains(s.node)&&(s.node.classList.contains(g.offline)?this.node.appendChild(s.node):this.node.prepend(s.node)),s.textContent.includes(e)||this.node.contains(s.node)&&this.node.removeChild(s.node)})}addOfflineUsers(e){e.forEach(s=>{this.createNewItem(s,!0),this.ws.send(JSON.stringify({id:String(_()),type:"MSG_FROM_USER",payload:{user:{login:s}}}))})}setUserOnline(e){let s=!0;this.children.forEach(n=>{n.id===e&&(n.removeClass(g.offline),s=!1)}),s&&this.createNewItem(e)}setUserOffline(e){let s=!0;this.children.forEach(n=>{n.id===e&&(n.addClass(g.offline),s=!1)}),s&&this.createNewItem(e,!0)}updateUnreadMessagesNumber(e){const s=this.session.getUnreadMessagesNumber(e)||0,n=document.getElementById(e);if(n){const a=n.lastElementChild,r=a.firstChild;r.textContent=s.toString(),s?a.classList.remove(g.hidden):a.classList.add(g.hidden)}}}const kt="data:image/svg+xml,%3csvg%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M16%206L5%2017L1%2013'%20stroke='hsl(96,%2016%25,%2064%25)'%20stroke-width='2'%20stroke-linecap='round'/%3e%3c/svg%3e",Bt="data:image/svg+xml,%3csvg%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M12%2017L11.2929%2017.7071L12%2018.4142L12.7071%2017.7071L12%2017ZM23.7071%206.70711C24.0976%206.31658%2024.0976%205.68342%2023.7071%205.29289C23.3166%204.90237%2022.6834%204.90237%2022.2929%205.29289L23.7071%206.70711ZM5%2017L4.29289%2017.7071L5%2018.4142L5.70711%2017.7071L5%2017ZM16.7071%206.70711C17.0976%206.31658%2017.0976%205.68342%2016.7071%205.29289C16.3166%204.90237%2015.6834%204.90237%2015.2929%205.29289L16.7071%206.70711ZM1.70711%2012.2929C1.31658%2011.9024%200.683418%2011.9024%200.292893%2012.2929C-0.0976311%2012.6834%20-0.0976311%2013.3166%200.292893%2013.7071L1.70711%2012.2929ZM12.7071%2017.7071L23.7071%206.70711L22.2929%205.29289L11.2929%2016.2929L12.7071%2017.7071ZM9.29289%2015.7071L11.2929%2017.7071L12.7071%2016.2929L10.7071%2014.2929L9.29289%2015.7071ZM5.70711%2017.7071L16.7071%206.70711L15.2929%205.29289L4.29289%2016.2929L5.70711%2017.7071ZM0.292893%2013.7071L4.29289%2017.7071L5.70711%2016.2929L1.70711%2012.2929L0.292893%2013.7071Z'%20fill='hsl(96,%2016%25,%2064%25)'/%3e%3c/svg%3e",It="data:image/svg+xml,%3csvg%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M12%2017L11.2929%2017.7071L12%2018.4142L12.7071%2017.7071L12%2017ZM23.7071%206.70711C24.0976%206.31658%2024.0976%205.68342%2023.7071%205.29289C23.3166%204.90237%2022.6834%204.90237%2022.2929%205.29289L23.7071%206.70711ZM5%2017L4.29289%2017.7071L5%2018.4142L5.70711%2017.7071L5%2017ZM16.7071%206.70711C17.0976%206.31658%2017.0976%205.68342%2016.7071%205.29289C16.3166%204.90237%2015.6834%204.90237%2015.2929%205.29289L16.7071%206.70711ZM1.70711%2012.2929C1.31658%2011.9024%200.683418%2011.9024%200.292893%2012.2929C-0.0976311%2012.6834%20-0.0976311%2013.3166%200.292893%2013.7071L1.70711%2012.2929ZM12.7071%2017.7071L23.7071%206.70711L22.2929%205.29289L11.2929%2016.2929L12.7071%2017.7071ZM9.29289%2015.7071L11.2929%2017.7071L12.7071%2016.2929L10.7071%2014.2929L9.29289%2015.7071ZM5.70711%2017.7071L16.7071%206.70711L15.2929%205.29289L4.29289%2016.2929L5.70711%2017.7071ZM0.292893%2013.7071L4.29289%2017.7071L5.70711%2016.2929L1.70711%2012.2929L0.292893%2013.7071Z'%20fill='hsl(240,%2056%25,%2064%25)'/%3e%3c/svg%3e",yt="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%200%2024%2024'%20width='24'%3e%3cpath%20d='M0%200h24v24H0V0z'%20fill='none'/%3e%3cpath%20d='M3%2017.46v3.04c0%20.28.22.5.5.5h3.04c.13%200%20.26-.05.35-.15L17.81%209.94l-3.75-3.75L3.15%2017.1c-.1.1-.15.22-.15.36zM20.71%207.04c.39-.39.39-1.02%200-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41%200l-1.83%201.83%203.75%203.75%201.83-1.83z'/%3e%3c/svg%3e",St="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%200%2024%2024'%20width='24'%3e%3cpath%20d='M0%200h24v24H0V0z'%20fill='none'/%3e%3cpath%20d='M6%2019c0%201.1.9%202%202%202h8c1.1%200%202-.9%202-2V9c0-1.1-.9-2-2-2H8c-1.1%200-2%20.9-2%202v10zM9%209h6c.55%200%201%20.45%201%201v8c0%20.55-.45%201-1%201H9c-.55%200-1-.45-1-1v-8c0-.55.45-1%201-1zm6.5-5l-.71-.71c-.18-.18-.44-.29-.7-.29H9.91c-.26%200-.52.11-.7.29L8.5%204H6c-.55%200-1%20.45-1%201s.45%201%201%201h12c.55%200%201-.45%201-1s-.45-1-1-1h-2.5z'/%3e%3c/svg%3e";class Nt extends o{constructor(e,s=!1){super(h.messageWrapper);i(this,"from");i(this,"messageBlock",new o(h.messageBlock));i(this,"textBlock",new o(h.textBlock,"span"));i(this,"stateIcon",new I(kt,h.stateIcon));i(this,"marker",new o(h.marker,"span","(edited)"));i(this,"contextMenu",new o(h.contextMenu));i(this,"editButton",new p(null,"button",yt));i(this,"deleteButton",new p(null,"button",St));i(this,"ws",w.getWS().ws);i(this,"returnButton",new p(null,"button",B));this.from=e.from,this.addClass(s?h.own:h.chatterer),this.id=e.id;const n=new o(h.title),a=new o(h.nickNameBlock,"div",e.from),r=new Date(e.datetime),u=new o(h.dateBlock,"div",`${r.toLocaleDateString()} ${r.toLocaleTimeString()}`);this.textBlock.textContent=e.text,s&&this.messageBlock.appendChild(this.stateIcon),this.setState(e.status,s),n.appendChildren(a,u),this.appendChildren(n),this.render(s),this.init(s)}render(e){this.messageBlock.prepend(this.textBlock),this.contextMenu.appendChildren(this.editButton,this.deleteButton,this.returnButton),this.appendChild(this.messageBlock),e&&this.appendChild(this.contextMenu)}init(e){this.stateIcon.setAttribute("align","right"),this.contextMenu.addClass(h.hidden),e&&this.addListener("contextmenu",s=>{s.preventDefault(),this.contextMenu.removeClass(h.hidden),this.returnButton.addListener("click",()=>{this.contextMenu.addClass(h.hidden)}),this.editButton.addClass("edit-message"),this.deleteButton.addListener("click",()=>{this.ws.send(JSON.stringify({id:String(_()),type:"MSG_DELETE",payload:{message:{id:this.id}}}))})})}setState(e,s){e.isDelivered&&s&&this.setDelivered(),e.isEdited&&this.setEdited(),e.isReaded&&s&&this.setReaded()}setDelivered(){this.stateIcon.setAttribute("src",Bt),this.messageBlock.appendChild(this.stateIcon)}setEdited(){this.messageBlock.appendChild(this.marker)}setReaded(){this.node.classList.contains(h.own)&&(this.stateIcon.setAttribute("src",It),this.messageBlock.appendChild(this.stateIcon))}handleVisible(e){const s=e.node.getBoundingClientRect(),n=this.node.getBoundingClientRect();if(n.top>=s.top&&n.left>=s.left&&n.bottom-4<=s.bottom&&n.right<=s.right&&this.node.classList.contains(h.chatterer)){const r={id:String(_()),type:"MSG_READ",payload:{message:{id:this.id}}};this.ws.send(JSON.stringify(r))}}getMessage(){return this.textBlock.textContent}setMessage(e){this.textBlock.textContent=e}hideContextMenu(){this.contextMenu.addClass(h.hidden)}getFrom(){return this.from}}const Et="_modal-window_1ir9a_1",Rt="_message-box_1ir9a_46",Tt="_return-button_1ir9a_51",N={"modal-window":"_modal-window_1ir9a_1",modalWindow:Et,"message-box":"_message-box_1ir9a_46",messageBox:Rt,"return-button":"_return-button_1ir9a_51",returnButton:Tt};class j extends o{constructor(e,s){super();i(this,"element");i(this,"returnButton",new p(()=>{this.close()},"button",B,N.returnButton));i(this,"messageBox",new o(N.messageBox));this.element=document.createElement("dialog"),e&&(this.messageBox.textContent=e),s&&this.open(),this.addClass(N.modalWindow),this.appendChildren(this.messageBox,this.returnButton)}open(){this.setAttribute("open")}close(){this.element.close()}setMessage(e){this.textContent=e}}const At="Select a user in the side bar to send a message...",q="Write and send your first message using the form below...";class Ut extends o{constructor(){super(c.ChatPage);i(this,"ws",w.getWS().ws);i(this,"session",b.getSession());i(this,"state","");i(this,"user",this.session.user);i(this,"userList",null);i(this,"sideBar",new o(c.sideBar,"aside"));i(this,"searchInput",new T("Find user...",c.searchInput));i(this,"hintMessage",new o(c.hintMessage,"div",At));i(this,"nickNameBlock",new o(c.nickName));i(this,"chattererStatusBlock",new o(c.chattererStatus));i(this,"sendMessageForm",new o(c.sendMessage,"form"));i(this,"sendMessageInput",new T("Message...",c.sendMessageInput));i(this,"sendMessageButton",new p(null,"submit",Je,c.lowButton));i(this,"cancelEditButton",new p(null,"button",Ke,c.cancelEditButton));i(this,"chattererName","");i(this,"chatWrapper",new o(c.chatWrapper));i(this,"divider",new o(c.divider));i(this,"sendMessage",()=>{this.sendMessageInput.value.length&&this.chattererName.length&&this.ws.send(JSON.stringify({id:String(_()),type:"MSG_SEND",payload:{message:{to:this.chattererName,text:this.sendMessageInput.value}}})),this.sendMessageInput.value=""});i(this,"finishEditMessage",()=>{this.cancelEditButton.addClass(c.hidden),this.sendMessageInput.value="",this.sendMessageButton.node.onclick=this.sendMessage});this.init(),this.render(this.user.login)}render(e){const s=new at(e),n=new o(c.chat,"main"),a=new o(c.chatSection,"section"),r=new o(c.chatTitle),u=new p(()=>{this.sideBar.addClass(c.visible)},"button",B,c.lowButton,c.returnButton);this.sendMessageForm.appendChildren(this.sendMessageInput,this.sendMessageButton),r.appendChildren(this.nickNameBlock,this.chattererStatusBlock,u),this.chatWrapper.appendChildren(this.hintMessage),a.appendChildren(this.sendMessageForm,r,this.chatWrapper),n.appendChildren(this.sideBar,a);const m=new _t;this.appendChildren(s,n,m)}init(){this.ws.send(JSON.stringify({id:String(_()),type:"USER_ACTIVE",payload:null})),this.ws.onmessage=s=>{var a,r,u,m;const n=JSON.parse(s.data);if(n.type==="USER_LOGIN"&&(this.user.login=n.payload.user.login,n.payload.user.isLogined&&(window.location.hash="/main",this.user.isLogined=!0)),n.type==="ERROR"&&this.appendChild(new j(`Error: ${n.payload.error}`,!0)),n.type==="USER_LOGOUT"&&(this.user.isLogined=!1,this.state="logout",window.location.hash="/login"),n.type==="USER_ACTIVE"&&this.createUsersList(n.payload.users.map(l=>l.login)),n.type==="USER_INACTIVE"&&this.userList.addOfflineUsers(n.payload.users.map(l=>l.login)),n.type==="MSG_FROM_USER"&&(n.payload.messages.length&&this.state==="startChat"?(this.createCorrespondence(n.payload.messages),this.state=""):this.state==="startChat"?(this.hintMessage.textContent=q,this.chatWrapper.appendChild(this.hintMessage)):this.updateUnreadMessagesNumber(n.payload.messages)),n.type==="USER_EXTERNAL_LOGIN"&&((a=this.userList)==null||a.setUserOnline(n.payload.user.login),this.nickNameBlock.textContent===n.payload.user.login&&(this.chattererStatusBlock.textContent="online")),n.type==="USER_EXTERNAL_LOGOUT"&&((r=this.userList)==null||r.setUserOffline(n.payload.user.login),this.nickNameBlock.textContent===n.payload.user.login&&(this.chattererStatusBlock.textContent="offline")),n.type==="MSG_SEND"){const{message:l}=n.payload;this.createMessage(l),l.from!==this.user.login&&(this.session.incrementUnreadMessagesNumber(l.from),(u=this.userList)==null||u.updateUnreadMessagesNumber(l.from))}if(n.type==="MSG_DELIVER"&&this.session.getMessage(n.payload.message.id).setDelivered(),n.type==="MSG_READ"){const l=this.session.getMessage(n.payload.message.id);l==null||l.setReaded();const A=(l==null?void 0:l.getFrom())||"";this.session.decrementUnreadMessagesNumber(A),(m=this.userList)==null||m.updateUnreadMessagesNumber(A)}if(n.type==="MSG_DELETE"&&this.session.deleteMessage(n.payload.message.id),n.type==="MSG_EDIT"){const l=this.session.getMessage(n.payload.message.id);l==null||l.setMessage(n.payload.message.text),l==null||l.setEdited()}},this.sendMessageForm.addListener("submit",s=>{s.preventDefault()});const e=new o(c.dividerText,"span","new messages");this.divider.appendChild(e),this.chatWrapper.addListener("scroll",()=>{this.session.iterateMessages(s=>s.handleVisible(this.chatWrapper))}),this.chatWrapper.addListener("click",s=>{const n=s.target;if(n.closest(".edit-message")){const a=n.closest(".edit-message"),r=a==null?void 0:a.closest(`.${h.contextMenu}`),u=r==null?void 0:r.closest(`.${h.messageWrapper}`),m=u==null?void 0:u.id;this.editMessage(m)}}),this.sendMessageButton.setAttribute("disabled"),this.sendMessageInput.setAttribute("disabled"),this.cancelEditButton.addClass(c.hidden),this.cancelEditButton.node.onclick=this.finishEditMessage,this.sendMessageButton.node.onclick=this.sendMessage,this.sendMessageForm.appendChild(this.cancelEditButton)}createUsersList(e){this.userList=new xt(e,c.userList),this.searchInput.addListener("input",()=>{this.userList.filter(this.searchInput.value)}),this.userList.addListener("click",s=>{var a,r;this.sendMessageButton.removeAttribute("disabled"),this.sendMessageInput.removeAttribute("disabled"),this.session.clearMessages(),this.chatWrapper.removeChildren();const n=s.target;this.chattererName=((a=n.closest("li"))==null?void 0:a.firstChild.textContent)||"",this.nickNameBlock.textContent=this.chattererName,this.chattererStatusBlock.textContent=(r=n.closest("li"))!=null&&r.classList.value.includes("offline")?"offline":"online",this.state="startChat",this.ws.send(JSON.stringify({id:String(_()),type:"MSG_FROM_USER",payload:{user:{login:this.chattererName}}}))}),this.sideBar.appendChildren(this.searchInput,this.userList),this.ws.send(JSON.stringify({id:String(_()),type:"USER_INACTIVE",payload:null}))}updateUnreadMessagesNumber(e){var s;if(e.length){let n="";e.forEach(a=>{a.from!==this.user.login&&!a.status.isReaded&&(this.session.incrementUnreadMessagesNumber(a.from),n=a.from)}),n&&((s=this.userList)==null||s.updateUnreadMessagesNumber(n))}}createCorrespondence(e){e.length?e.forEach(s=>this.createMessage(s)):(this.hintMessage.removeClass(c.hidden),this.hintMessage.textContent=q)}createMessage(e){const s=this.user.login===e.from;if(e.from===this.chattererName||s){this.hintMessage.addClass(c.hidden);const n=new Nt(e,s);this.session.putMessage(e.id,n),this.chatWrapper.appendChild(n),!e.status.isReaded&&!this.session.isThereUnread&&!s?(this.session.isThereUnread=!0,this.chatWrapper.appendChild(this.divider),this.scrollToDivider()):this.scrollToEnd()}}editMessage(e){const s=this.session.getMessage(e),n=()=>{this.finishEditMessage(),s==null||s.returnButton.removeListener("click",n)};s==null||s.returnButton.addListener("click",n),this.sendMessageInput.value=s==null?void 0:s.getMessage(),s==null||s.hideContextMenu(),this.cancelEditButton.removeClass(c.hidden),this.sendMessageInput.node.focus(),this.sendMessageButton.node.onclick=()=>{this.sendMessageInput.value.length&&(this.ws.send(JSON.stringify({id:String(_()),type:"MSG_EDIT",payload:{message:{id:e,text:this.sendMessageInput.value}}})),this.finishEditMessage())}}scrollToEnd(){this.chatWrapper.node.scrollTop=this.chatWrapper.node.scrollHeight}scrollToDivider(){const e=this.chatWrapper.node.getBoundingClientRect(),n=this.divider.node.getBoundingClientRect().top-e.top;this.chatWrapper.node.scrollTop+=n}getState(){return this.state}}const Pt="_main_abkt9_1",qt={main:Pt},Ot="_login-form_19ttn_1",Vt="_about-link_19ttn_9",zt="_hidden_19ttn_18",Wt="_tooltip_19ttn_25",$t="_buttons-wrapper_19ttn_33",L={"login-form":"_login-form_19ttn_1",loginForm:Ot,"about-link":"_about-link_19ttn_9",aboutLink:Vt,hidden:zt,tooltip:Wt,"buttons-wrapper":"_buttons-wrapper_19ttn_33",buttonsWrapper:$t},jt="_fieldset_1vaeb_1",Dt={fieldset:jt};class Ht extends o{constructor(e){super();i(this,"legend");i(this,"element");this.element=document.createElement("fieldset"),this.addClass(Dt.fieldset),e&&(this.legend=new o("","legend",e),this.appendChild(this.legend))}}const Gt="_label_148u2_1",Ft="_tooltip_148u2_8",Zt={label:Gt,tooltip:Ft},Jt="_password-input_11kwa_1",Kt="_invalid_11kwa_11",E={"password-input":"_password-input_11kwa_1",passwordInput:Jt,invalid:Kt};class Xt extends ${constructor(t){super(E.passwordInput),this.setAttribute("type","password"),t&&this.setAttribute("placeholder",t)}setInvalid(){this.addClass(E.invalid)}setValid(){this.removeClass(E.invalid)}}class O extends o{constructor(e,s,n){super();i(this,"input");i(this,"element");this.element=document.createElement("label"),this.textContent=e,this.addClass(Zt.label),this.input=s==="text"?new T(n):new Xt(n),this.appendChild(this.input)}get value(){return this.input.value}set value(e){this.input.value=e}setInvalid(){this.input.setInvalid()}setValid(){this.input.setValid()}}const Yt="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20enable-background='new%200%200%2024%2024'%20height='24'%20viewBox='0%200%2024%2024'%20width='24'%3e%3cg%3e%3crect%20fill='none'%20height='24'%20width='24'/%3e%3crect%20fill='none'%20height='24'%20width='24'/%3e%3c/g%3e%3cg%3e%3cpath%20d='M10.3,7.7L10.3,7.7c-0.39,0.39-0.39,1.01,0,1.4l1.9,1.9H3c-0.55,0-1,0.45-1,1v0c0,0.55,0.45,1,1,1h9.2l-1.9,1.9%20c-0.39,0.39-0.39,1.01,0,1.4l0,0c0.39,0.39,1.01,0.39,1.4,0l3.59-3.59c0.39-0.39,0.39-1.02,0-1.41L11.7,7.7%20C11.31,7.31,10.69,7.31,10.3,7.7z%20M20,19h-7c-0.55,0-1,0.45-1,1v0c0,0.55,0.45,1,1,1h7c1.1,0,2-0.9,2-2V5c0-1.1-0.9-2-2-2h-7%20c-0.55,0-1,0.45-1,1v0c0,0.55,0.45,1,1,1h7V19z'/%3e%3c/g%3e%3c/svg%3e",Qt="The name must be in English letters, starting with capital.",es="Minimum name length - 2 and maximum - 12 characters.",ts="Minimum password length - 4 characters.",ss="Must contain at least 1 English letter and 1 number.";class ns extends o{constructor(){super();i(this,"fieldset",new Ht("Authorization"));i(this,"nameInput",new O("Name","text","Enter your name"));i(this,"passwordInput",new O("Password","password","Enter password"));i(this,"firstRuleNameTooltip",new o(L.tooltip));i(this,"secondRuleNameTooltip",new o(L.tooltip));i(this,"firstRulePasswordTooltip",new o(L.tooltip));i(this,"secondRulePasswordTooltip",new o(L.tooltip));i(this,"loginButton",new p(null,"submit",Yt,"","login-button"));i(this,"infoButton",new p(()=>{console.log("меняю хэш при клике инфо кнопки в логин форме"),window.location.hash="/about"},"button",W));i(this,"isNameValid",!1);i(this,"isPasswordValid",!1);i(this,"user",b.getSession().user);i(this,"ws",w.getWS().ws);i(this,"element");this.element=document.createElement("form"),this.addClass(L.loginForm),this.init(),this.render()}render(){this.fieldset.appendChildren(this.nameInput,this.firstRuleNameTooltip,this.secondRuleNameTooltip,this.passwordInput,this.firstRulePasswordTooltip,this.secondRulePasswordTooltip);const e=new o(L.buttonsWrapper);e.appendChildren(this.loginButton,this.infoButton),this.appendChildren(this.fieldset,e)}init(){this.addListener("submit",e=>{e.preventDefault()}),this.loginButton.disable(),this.loginButton.addListener("click",()=>{this.user.password=this.passwordInput.value,this.ws.send(JSON.stringify({id:String(_()),type:"USER_LOGIN",payload:{user:{login:`${this.nameInput.value}`,password:`${this.passwordInput.value}`}}}))}),this.nameInput.addListener("input",()=>{this.validateName()}),this.passwordInput.addListener("input",()=>{this.validatePassword()}),this.addListener("input",()=>{this.isNameValid&&this.isPasswordValid?this.loginButton.enable():this.loginButton.disable()})}validateName(){let e=!1;/^[A-Z][a-zA-Z]*$/.test(this.nameInput.value)?(this.firstRuleNameTooltip.textContent="",e=!0):(this.firstRuleNameTooltip.textContent=Qt,this.nameInput.setInvalid(),this.loginButton.disable()),/.{2,12}/.test(this.nameInput.value)?(this.secondRuleNameTooltip.textContent="",e&&(e=!0)):(this.secondRuleNameTooltip.textContent=es,this.nameInput.setInvalid(),this.loginButton.disable(),e=!1),e&&(this.nameInput.setValid(),this.isNameValid=!0),this.isNameValid=e}validatePassword(){let e=!1;/.{4,}/.test(this.passwordInput.value)?(this.firstRulePasswordTooltip.textContent="",e=!0):(this.firstRulePasswordTooltip.textContent=ts,this.passwordInput.setInvalid(),this.loginButton.disable()),/^(?=.*[a-zA-Z])(?=.*\d).+/.test(this.passwordInput.value)?(this.secondRulePasswordTooltip.textContent="",e&&(e=!0)):(this.secondRulePasswordTooltip.textContent=ss,this.passwordInput.setInvalid(),this.loginButton.disable(),e=!1),e&&this.passwordInput.setValid(),this.isPasswordValid=e}}class V extends o{constructor(){super(qt.main,"main"),this.appendChild(new ns)}}const is="ws://127.0.0.1:4000/";class as extends o{constructor(e){super(e);i(this,"user",b.getSession().user);i(this,"chatPage",null);this.init()}init(){const{ws:e}=w.getWS(is);e.onmessage=n=>{const a=JSON.parse(n.data);a.type==="USER_LOGIN"&&(this.user.login=a.payload.user.login,a.payload.user.isLogined&&(window.location.hash="/main",this.user.isLogined=!0)),a.type==="ERROR"&&this.appendChild(new j(`Error: ${a.payload.error}`,!0))};let s=window.location.hash.slice(2);s?this.renderNewPage(s):(window.location.hash="#/",this.renderNewPage("")),window.onhashchange=()=>{s=window.location.hash.slice(2),this.renderNewPage(s)}}renderNewPage(e){switch(this.removeChildren(),e){case"":this.appendChild(new V);break;case"login":this.user.isLogined?window.location.hash="/main":this.appendChild(new V);break;case"main":this.user.isLogined?(this.chatPage&&this.chatPage.getState()==="logout"&&(this.chatPage=null),this.chatPage||(this.chatPage=new Ut),this.appendChild(this.chatPage)):(this.chatPage=null,window.location.hash="/login");break;case"about":this.appendChild(new me);break;default:this.appendChild(new ae);break}}}const os=new as("app-container");document.body.appendChild(os.node);
