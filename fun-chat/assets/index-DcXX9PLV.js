var j=Object.defineProperty;var D=(r,t,e)=>t in r?j(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var i=(r,t,e)=>(D(r,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function e(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(s){if(s.ep)return;s.ep=!0;const a=e(s);fetch(s.href,a)}})();const H="_main_1d7em_1",G="_error-msg_1d7em_12",F="_no-page-msg_1d7em_16",I={main:H,"error-msg":"_error-msg_1d7em_12",errorMsg:G,"no-page-msg":"_no-page-msg_1d7em_16",noPageMsg:F},k="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20enable-background='new%200%200%2024%2024'%20height='24'%20viewBox='0%200%2024%2024'%20width='24'%3e%3crect%20fill='none'%20height='24'%20width='24'/%3e%3cg%3e%3cpath%20d='M16.88,2.88L16.88,2.88c-0.49-0.49-1.28-0.49-1.77,0l-8.41,8.41c-0.39,0.39-0.39,1.02,0,1.41l8.41,8.41%20c0.49,0.49,1.28,0.49,1.77,0l0,0c0.49-0.49,0.49-1.28,0-1.77L9.54,12l7.35-7.35C17.37,4.16,17.37,3.37,16.88,2.88z'/%3e%3c/g%3e%3c/svg%3e";class o{constructor(t,e="div",n){i(this,"childrenArr");i(this,"element");this.element=document.createElement(e),t&&this.addClass(t),n&&(this.textContent=n),this.childrenArr=[]}get node(){return this.element}get children(){return this.childrenArr}get textContent(){return this.element.textContent||""}set textContent(t){this.element.textContent=t}get id(){return this.node.id}set id(t){this.node.id=t}appendChild(t){this.children.push(t),this.node.appendChild(t.node)}appendChildren(...t){t.forEach(e=>{this.appendChild(e)})}prepend(t){this.children.push(t),this.node.prepend(t.node)}removeChildren(){this.children.length=0,this.node.innerHTML=""}removeNode(){this.node.remove()}removeSelf(){this.removeChildren(),this.removeNode()}setStyle(t,e){const n=t;this.node.style.setProperty(n,e)}setAttribute(t,e){this.node.setAttribute(t,e||"")}removeAttribute(t){this.node.removeAttribute(t)}addClass(t){this.node.classList.contains(t)||this.node.classList.add(t)}toggleClass(t){this.node.classList.toggle(t)}removeClass(t){this.node.classList.remove(t)}addClassToChildren(t){this.children.forEach(e=>e.addClass(t))}removeClassFromChildren(t){this.children.forEach(e=>e.removeClass(t))}addClassToChild(t,e){this.children[t]&&this.children[t].addClass(e)}removeClassFromChild(t,e){this.children[t]&&this.children[t].removeClass(e)}addListener(t,e){this.node.addEventListener(t,e)}removeListener(t,e){this.node.removeEventListener(t,e)}}const Z="_heading_1q6e1_1",J={heading:Z};class v extends o{constructor(e,n,s){super();i(this,"element");this.element=document.createElement(e),this.addClass(J.heading),s&&this.addClass(s),this.textContent=n}}const K="_button_rm83u_1",X="_hidden_rm83u_15",Y={button:K,hidden:X},Q="_icon_1g5nx_1",ee="_hidden_1g5nx_5",te={icon:Q,hidden:ee};class B extends o{constructor(e,n,s){super();i(this,"element");this.element=document.createElement("img"),n?this.addClass(n):this.addClass(te.icon),this.node.setAttribute("src",e),s&&this.node.setAttribute("alt",s)}}class p extends o{constructor(e,n="button",s,a,d,u,l){super();i(this,"element");this.element=document.createElement("button"),this.addClass(Y.button),e&&this.addListener("click",e),n&&this.setAttribute("type",n),a&&this.addClass(a),d&&(this.node.id=d),l&&(this.node.textContent=l),s&&this.appendChild(new B(s,u||""))}disable(){this.setAttribute("disabled")}enable(){this.removeAttribute("disabled")}}const se="An error occurred:",ne="the page you requested does not exist.";class ie extends o{constructor(){super(I.main,"main"),this.render()}render(){const t=new v("h1",se,I.errorMsg),e=new v("h2",ne,I.noPageMsg),n=new p(()=>{window.history.back()},"button",k);this.appendChildren(t,e,n)}}const ae="_main_5we50_1",oe="_about-wrapper_5we50_11",re="_app-name_5we50_18",de="_article_5we50_26",ce="_inline-icon_5we50_30",L={main:ae,"about-wrapper":"_about-wrapper_5we50_11",aboutWrapper:oe,"app-name":"_app-name_5we50_18",appName:re,article:de,"inline-icon":"_inline-icon_5we50_30",inlineIcon:ce},q="data:image/svg+xml,%3csvg%20width='98'%20height='96'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M48.854%200C21.839%200%200%2022%200%2049.217c0%2021.756%2013.993%2040.172%2033.405%2046.69%202.427.49%203.316-1.059%203.316-2.362%200-1.141-.08-5.052-.08-9.127-13.59%202.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015%204.934.326%207.523%205.052%207.523%205.052%204.367%207.496%2011.404%205.378%2014.235%204.074.404-3.178%201.699-5.378%203.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283%200-5.378%201.94-9.778%205.014-13.2-.485-1.222-2.184-6.275.486-13.038%200%200%204.125-1.304%2013.426%205.052a46.97%2046.97%200%200%201%2012.214-1.63c4.125%200%208.33.571%2012.213%201.63%209.302-6.356%2013.427-5.052%2013.427-5.052%202.67%206.763.97%2011.816.485%2013.038%203.155%203.422%205.015%207.822%205.015%2013.2%200%2018.905-11.404%2023.06-22.324%2024.283%201.78%201.548%203.316%204.481%203.316%209.126%200%206.6-.08%2011.897-.08%2013.526%200%201.304.89%202.853%203.316%202.364%2019.412-6.52%2033.405-24.935%2033.405-46.691C97.707%2022%2075.788%200%2048.854%200z'%20fill='%23aee58a'/%3e%3c/svg%3e",le="_icon-link_1jgus_1",he="_hidden_1jgus_13",ue="_icon_1jgus_1",A={"icon-link":"_icon-link_1jgus_1",iconLink:le,hidden:he,icon:ue};class E extends o{constructor(e,n,s,a,d=A.iconLink,u=!0){super();i(this,"icon");i(this,"element");this.element=document.createElement("a"),this.addClass(A.iconLink),d&&this.addClass(d),this.setAttribute("href",e),a&&(this.node.textContent=a),n&&(this.icon=new B(n,s||""),this.appendChild(this.icon)),u&&this.setAttribute("target","_blank")}}const pe="Have a nice chat.<br>App by ",ge="https://github.com/rolling-scopes-school/playoffthecuff-JSFE2023Q4/";class _e extends o{constructor(){super(L.main,"main"),this.render()}render(){const t=new o(L.aboutWrapper),e=new v("h1","Fun Chat",L.appName),n=new o(L.article,"article"),s=new E(ge,q,void 0,void 0,L.inlineIcon),a=new p(()=>{window.history.back()},"button",k);n.node.innerHTML=pe,n.appendChild(s),t.appendChildren(e,n,a),this.appendChild(t)}}const me="_chat_46lj4_1",we="_chat-page_46lj4_7",fe="_chat-section_46lj4_11",ve="_chat-wrapper_46lj4_25",Ce="_hint-message_46lj4_50",be="_hidden_46lj4_58",Me="_chat-title_46lj4_62",Le="_nick-name_46lj4_72",xe="_chatterer-status_46lj4_78",ke="_send-message_46lj4_83",Be="_send-message-input_46lj4_93",Ie="_low-button_46lj4_98",ye="_return-button_46lj4_1",Se="_user-list_46lj4_118",Ne="_side-bar_46lj4_161",Ee="_visible_46lj4_174",Re="_search-input_46lj4_185",Te="_divider_46lj4_189",Ae="_divider-text_46lj4_202",Ue="_cancel-edit-button_46lj4_211",c={chat:me,"chat-page":"_chat-page_46lj4_7",chatPage:we,"chat-section":"_chat-section_46lj4_11",chatSection:fe,"chat-wrapper":"_chat-wrapper_46lj4_25",chatWrapper:ve,"hint-message":"_hint-message_46lj4_50",hintMessage:Ce,hidden:be,"chat-title":"_chat-title_46lj4_62",chatTitle:Me,"nick-name":"_nick-name_46lj4_72",nickName:Le,"chatterer-status":"_chatterer-status_46lj4_78",chattererStatus:xe,"send-message":"_send-message_46lj4_83",sendMessage:ke,"send-message-input":"_send-message-input_46lj4_93",sendMessageInput:Be,"low-button":"_low-button_46lj4_98",lowButton:Ie,"return-button":"_return-button_46lj4_1",returnButton:ye,"user-list":"_user-list_46lj4_118",userList:Se,"side-bar":"_side-bar_46lj4_161",sideBar:Ne,visible:Ee,"search-input":"_search-input_46lj4_185",searchInput:Re,divider:Te,"divider-text":"_divider-text_46lj4_202",dividerText:Ae,"cancel-edit-button":"_cancel-edit-button_46lj4_211",cancelEditButton:Ue},Pe="_message-wrapper_855ce_1",Oe="_context-menu_855ce_10",Ve="_hidden_855ce_24",qe="_title_855ce_29",ze="_nick-name-block_855ce_37",We="_date-block_855ce_41",$e="_message-block_855ce_46",je="_text-block_855ce_51",De="_state-icon_855ce_61",He="_state-block_855ce_67",Ge="_own_855ce_72",Fe="_chatterer_855ce_76",h={"message-wrapper":"_message-wrapper_855ce_1",messageWrapper:Pe,"context-menu":"_context-menu_855ce_10",contextMenu:Oe,hidden:Ve,title:qe,"nick-name-block":"_nick-name-block_855ce_37",nickNameBlock:ze,"date-block":"_date-block_855ce_41",dateBlock:We,"message-block":"_message-block_855ce_46",messageBlock:$e,"text-block":"_text-block_855ce_51",textBlock:je,"state-icon":"_state-icon_855ce_61",stateIcon:De,"state-block":"_state-block_855ce_67",stateBlock:He,own:Ge,chatterer:Fe},Ze="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%200%2024%2024'%20width='24'%3e%3cpath%20d='M0%200h24v24H0V0z'%20fill='none'/%3e%3cpath%20d='M3.4%2020.4l17.45-7.48c.81-.35.81-1.49%200-1.84L3.4%203.6c-.66-.29-1.39.2-1.39.91L2%209.12c0%20.5.37.93.87.99L17%2012%202.87%2013.88c-.5.07-.87.5-.87%201l.01%204.61c0%20.71.73%201.2%201.39.91z'/%3e%3c/svg%3e",Je="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%200%2024%2024'%20width='24'%3e%3cpath%20d='M0%200h24v24H0V0z'%20fill='none'/%3e%3cpath%20d='M13.89%208.7L12%2010.59%2010.11%208.7c-.39-.39-1.02-.39-1.41%200-.39.39-.39%201.02%200%201.41L10.59%2012%208.7%2013.89c-.39.39-.39%201.02%200%201.41.39.39%201.02.39%201.41%200L12%2013.41l1.89%201.89c.39.39%201.02.39%201.41%200%20.39-.39.39-1.02%200-1.41L13.41%2012l1.89-1.89c.39-.39.39-1.02%200-1.41-.39-.38-1.03-.38-1.41%200zM12%202C6.47%202%202%206.47%202%2012s4.47%2010%2010%2010%2010-4.47%2010-10S17.53%202%2012%202zm0%2018c-4.41%200-8-3.59-8-8s3.59-8%208-8%208%203.59%208%208-3.59%208-8%208z'/%3e%3c/svg%3e",Ke="_user-block_3k1et_10",Xe="_user-icon_3k1et_18",Ye="_user-name_3k1et_26",Qe="_control-panel_3k1et_33",et="_app-name_3k1et_40",b={"user-block":"_user-block_3k1et_10",userBlock:Ke,"user-icon":"_user-icon_3k1et_18",userIcon:Xe,"user-name":"_user-name_3k1et_26",userName:Ye,"control-panel":"_control-panel_3k1et_33",controlPanel:Qe,"app-name":"_app-name_3k1et_40",appName:et},tt="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%200%2024%2024'%20width='24'%3e%3cpath%20d='M0%200h24v24H0V0z'%20fill='none'/%3e%3cpath%20d='M12%2012c2.21%200%204-1.79%204-4s-1.79-4-4-4-4%201.79-4%204%201.79%204%204%204zm0%202c-2.67%200-8%201.34-8%204v1c0%20.55.45%201%201%201h14c.55%200%201-.45%201-1v-1c0-2.66-5.33-4-8-4z'/%3e%3c/svg%3e",z="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%200%2024%2024'%20width='24'%3e%3cg%20fill='none'%3e%3cpath%20d='M0%200h24v24H0V0z'/%3e%3cpath%20d='M0%200h24v24H0V0z'%20opacity='.87'/%3e%3c/g%3e%3cpath%20d='M11%207h2v2h-2zm1%2010c.55%200%201-.45%201-1v-4c0-.55-.45-1-1-1s-1%20.45-1%201v4c0%20.55.45%201%201%201zm0-15C6.48%202%202%206.48%202%2012s4.48%2010%2010%2010%2010-4.48%2010-10S17.52%202%2012%202zm0%2018c-4.41%200-8-3.59-8-8s3.59-8%208-8%208%203.59%208%208-3.59%208-8%208z'/%3e%3c/svg%3e",st="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20enable-background='new%200%200%2024%2024'%20height='24'%20viewBox='0%200%2024%2024'%20width='24'%3e%3cg%3e%3cpath%20d='M0,0h24v24H0V0z'%20fill='none'/%3e%3c/g%3e%3cg%3e%3cg%3e%3cpath%20d='M5,5h6c0.55,0,1-0.45,1-1v0c0-0.55-0.45-1-1-1H5C3.9,3,3,3.9,3,5v14c0,1.1,0.9,2,2,2h6c0.55,0,1-0.45,1-1v0%20c0-0.55-0.45-1-1-1H5V5z'/%3e%3cpath%20d='M20.65,11.65l-2.79-2.79C17.54,8.54,17,8.76,17,9.21V11h-7c-0.55,0-1,0.45-1,1v0c0,0.55,0.45,1,1,1h7v1.79%20c0,0.45,0.54,0.67,0.85,0.35l2.79-2.79C20.84,12.16,20.84,11.84,20.65,11.65z'/%3e%3c/g%3e%3c/g%3e%3c/svg%3e",w=class w{constructor(t){i(this,"wsConnection");this.wsConnection=new WebSocket(t)}static getWS(t){return w.instance||(w.instance=new w(t)),w.instance}get ws(){return this.wsConnection}};i(w,"instance");let m=w;const f=class f{constructor(t){i(this,"userData",{login:"",isLogined:!1,password:""});i(this,"unreadMessagesNumber",new Map);i(this,"messages",new Map);i(this,"isThereUnreadMessage",!1);this.userData.login=t}static getSession(t){return f.instance||(f.instance=new f(t||"JohnDoe")),f.instance}get user(){return this.userData}get isThereUnread(){return this.isThereUnreadMessage}set isThereUnread(t){this.isThereUnreadMessage=t}getMessage(t){return this.messages.get(t)}putMessage(t,e){this.messages.set(t,e)}deleteMessage(t){var e;(e=this.messages.get(t))==null||e.removeSelf(),this.messages.delete(t)}clearMessages(){this.messages.clear()}iterateMessages(t){this.messages.forEach(t)}addEntryToUnreadMessagesNumber(t){this.unreadMessagesNumber.set(t,0)}incrementUnreadMessagesNumber(t){const e=this.unreadMessagesNumber.get(t)||0;this.unreadMessagesNumber.set(t,e+1)}decrementUnreadMessagesNumber(t){if(t){const e=this.unreadMessagesNumber.get(t)||1;this.unreadMessagesNumber.set(t,e-1)}}getUnreadMessagesNumber(t){return this.unreadMessagesNumber.get(t)}};i(f,"instance");let C=f;function nt(){let r=0;return()=>{const t=r;return r+=1,t}}const _=nt();class it extends o{constructor(e){super(b.header,"header");i(this,"ws",m.getWS().ws);i(this,"user",C.getSession().user);i(this,"infoButton",new p(()=>{window.location.hash="/about"},"button",z));i(this,"logoutButton",new p(()=>{this.ws.send(JSON.stringify({id:String(_()),type:"USER_LOGOUT",payload:{user:{login:this.user.login,password:this.user.password}}}))},"button",st));this.render(e)}render(e){this.createUserBlock(e),this.createHeading(),this.createControlPanel()}createUserBlock(e){const n=new o(b.userBlock),s=new B(tt,b.userIcon),a=new v("h3",e,b.userName);n.appendChildren(s,a),this.appendChild(n)}createHeading(){const e=new v("h1","Fun Chat",b.appName);this.appendChild(e)}createControlPanel(){const e=new o(b.controlPanel);e.appendChildren(this.infoButton,this.logoutButton),this.appendChild(e)}}const at="_user-block_1f6i0_15",ot="_rss-icon_1f6i0_21",rt="_gh-icon_1f6i0_31",dt="_author-name_1f6i0_35",ct="_year_1f6i0_41",x={"user-block":"_user-block_1f6i0_15",userBlock:at,"rss-icon":"_rss-icon_1f6i0_21",rssIcon:ot,"gh-icon":"_gh-icon_1f6i0_31",ghIcon:rt,"author-name":"_author-name_1f6i0_35",authorName:dt,year:ct},lt="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20552.85%20198.67'%3e%3ctitle%3ers_school%3c/title%3e%3cg%20data-name='Layer%202'%3e%3cg%20data-name='Layer%201'%3e%3cpath%20d='M275.36%2061.37l26.29-1.65q.86%206.41%203.48%209.76%204.28%205.43%2012.2%205.43%205.91%200%209.12-2.77a8.34%208.34%200%200%200%203.2-6.44%208.18%208.18%200%200%200-3-6.22q-3-2.74-14.15-5.19-18.18-4.08-25.93-10.86a21.84%2021.84%200%200%201-7.81-17.26%2023.44%2023.44%200%200%201%204-13%2026.47%2026.47%200%200%201%2012-9.64q8-3.51%2022-3.51%2017.14%200%2026.14%206.38t10.71%2020.28l-26.05%201.52q-1-6-4.36-8.78t-9.2-2.77c-3.21%200-5.63.69-7.25%202.05a6.25%206.25%200%200%200-2.44%205%205%205%200%200%200%202%203.84q1.95%201.77%209.27%203.3%2018.12%203.9%2026%207.9t11.4%209.91a25.12%2025.12%200%200%201%203.57%2013.24%2028.37%2028.37%200%200%201-4.75%2015.86%2029.83%2029.83%200%200%201-13.3%2011q-8.55%203.75-21.54%203.75-22.81%200-31.6-8.78t-10-22.35zM6.27%2091V1.53h46.06q12.81%200%2019.58%202.19a20.93%2020.93%200%200%201%2010.92%208.14A24.75%2024.75%200%200%201%2087%2026.35a24.8%2024.8%200%200%201-3.2%2012.84A24.91%2024.91%200%200%201%2075.07%2048a33.63%2033.63%200%200%201-9.7%203.54%2027.79%2027.79%200%200%201%207.19%203.29A27.79%2027.79%200%200%201%2077%2059.49%2035.16%2035.16%200%200%201%2080.85%2065l13.38%2026H63L48.24%2063.63q-2.81-5.31-5-6.9a11.63%2011.63%200%200%200-6.78-2.07H34V91zM34%2037.76h11.68A41%2041%200%200%200%2053%2036.54a7.3%207.3%200%200%200%204.48-2.81%208.24%208.24%200%200%200%201.74-5.18%208.23%208.23%200%200%200-2.75-6.65q-2.74-2.32-10.31-2.32H34zM0%20167.56l26.29-1.64q.86%206.41%203.48%209.76Q34%20181.11%2042%20181.11q5.91%200%209.12-2.78a8.34%208.34%200%200%200%203.2-6.44%208.2%208.2%200%200%200-3-6.22q-3-2.74-14.15-5.18-18.18-4.1-25.93-10.86a21.87%2021.87%200%200%201-7.81-17.27%2023.49%2023.49%200%200%201%204-13%2026.47%2026.47%200%200%201%2012-9.64q8-3.51%2022-3.51%2017.14%200%2026.14%206.38t10.71%2020.28l-26%201.53q-1-6-4.36-8.79t-9.19-2.74q-4.81%200-7.25%202a6.25%206.25%200%200%200-2.44%205%205%205%200%200%200%202%203.85q1.95%201.77%209.27%203.29%2018.12%203.9%2026%207.9t11.4%209.91a25.15%2025.15%200%200%201%203.57%2013.24%2028.35%2028.35%200%200%201-4.75%2015.86%2029.83%2029.83%200%200%201-13.3%2011q-8.55%203.75-21.54%203.75-22.81%200-31.6-8.78T0%20167.56zm163-7.01l24.22%207.32a44.72%2044.72%200%200%201-7.69%2017%2033.46%2033.46%200%200%201-13%2010.31q-7.78%203.47-19.8%203.47-14.58%200-23.82-4.23t-16-14.91q-6.72-10.67-6.71-27.31%200-22.18%2011.8-34.11t33.4-11.92q16.91%200%2026.57%206.84t14.36%2021l-24.4%205.43a21%2021%200%200%200-2.68-6%2016%2016%200%200%200-5.67-4.88%2016.31%2016.31%200%200%200-7.51-1.71q-9.39%200-14.39%207.56-3.8%205.61-3.79%2017.61%200%2014.86%204.52%2020.38t12.69%205.51q7.92%200%2012-4.45t5.9-12.91zm45.51-52.83h27.63V139h30.2v-31.28h27.75v89.43h-27.75V161h-30.2v36.18h-27.63zm102.78%2044.77q0-21.88%2012.2-34.1t34-12.2q22.32%200%2034.4%2012T404%20151.76q0%2015.69-5.28%2025.72a37.54%2037.54%200%200%201-15.25%2015.61q-10%205.58-24.86%205.58-15.12%200-25-4.82a37.59%2037.59%200%200%201-16.07-15.25q-6.26-10.42-6.25-26.11zm27.63.13q0%2013.55%205%2019.46t13.7%205.91q8.91%200%2013.79-5.79t4.88-20.8q0-12.63-5.1-18.46t-13.82-5.82A16.78%2016.78%200%200%200%20344%20133q-5.07%206-5.08%2019.62z'/%3e%3cpath%20d='M392.28%20152.49q0-21.88%2012.2-34.1t34-12.2q22.34%200%2034.41%2012t12.07%2033.58q0%2015.69-5.27%2025.72a37.6%2037.6%200%200%201-15.25%2015.61q-10%205.58-24.86%205.58-15.13%200-25-4.82a37.67%2037.67%200%200%201-16.08-15.25q-6.22-10.43-6.22-26.12zm27.64.13q0%2013.55%205%2019.46t13.72%205.92q8.91%200%2013.79-5.79t4.88-20.8q0-12.63-5.09-18.46t-13.82-5.82A16.77%2016.77%200%200%200%20425%20133q-5.09%206-5.08%2019.62z'/%3e%3cpath%20d='M482.08%20107.72h27.64v67.41h43.13v22h-70.77z'/%3e%3c/g%3e%3c/g%3e%3c/svg%3e",ht="https://rs.school/",ut="https://github.com/playoffthecuff",pt="evgenii";class gt extends o{constructor(){super(void 0,"footer"),this.render()}render(){this.createRSSLink(),this.createUserBlock(),this.createYear()}createRSSLink(){const t=new E(ht,lt,"","",x.rssIcon);this.appendChild(t)}createUserBlock(){const t=new o(x.userBlock),e=new E(ut,q,"","",x.ghIcon),n=new v("h3",pt,x.authorName);t.appendChildren(e,n),this.appendChild(t)}createYear(){const t=new v("h2",new Date().getFullYear().toString(),x.year);this.appendChild(t)}}const _t="_text-input_1a6ht_1",mt="_invalid_1a6ht_11",y={"text-input":"_text-input_1a6ht_1",textInput:_t,invalid:mt};class W extends o{constructor(e){super();i(this,"element");this.element=document.createElement("input"),this.addClass(e)}get value(){return this.element.value}set value(e){this.element.value=e}}class R extends W{constructor(t,e){super(y.textInput),this.setAttribute("type","text"),t&&this.setAttribute("placeholder",t),e&&this.addClass(e)}setInvalid(){this.addClass(y.invalid)}setValid(){this.removeClass(y.invalid)}}const wt="_offline_n8vyb_1",ft="_unread-messages_n8vyb_8",vt="_text-block_n8vyb_19",Ct="_hidden_n8vyb_27",g={offline:wt,"unread-messages":"_unread-messages_n8vyb_8",unreadMessages:ft,"text-block":"_text-block_n8vyb_19",textBlock:vt,hidden:Ct},bt="data:image/svg+xml,%3csvg%20width='24'%20height='24'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%3e%3ctitle%3ebackground%3c/title%3e%3crect%20fill='none'%20id='canvas_background'%20height='402'%20width='582'%20y='-1'%20x='-1'/%3e%3c/g%3e%3cg%3e%3ctitle%3eLayer%201%3c/title%3e%3cg%20id='svg_1'%3e%3crect%20id='svg_2'%20fill='none'%20width='24'%20height='24'/%3e%3c/g%3e%3cg%20stroke='null'%20id='svg_3'%3e%3cg%20stroke='null'%20id='svg_4'%3e%3cpath%20stroke='null'%20id='svg_5'%20fill='hsl(0,%200%25,%2048%25)'%20d='m20,4.137689l0,12.826136l-14.83,0l-1.17,1.250548l0,-14.076684l16,0m0,-2.137689l-16,0c-1.1,0%20-2,0.96196%20-2,2.137689l0,16.663288c0,0.951272%201.08,1.432252%201.71,0.75888l2.29,-2.458343l14,0c1.1,0%202,-0.96196%202,-2.137689l0,-12.826136c0,-1.175729%20-0.9,-2.137689%20-2,-2.137689z'/%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/svg%3e",U={};class Mt extends o{constructor(e,n){super();i(this,"element");this.element=document.createElement("li"),U.listItem&&this.addClass(U.listItem),e&&(this.textContent=e),n&&this.addClass(n)}}class Lt extends o{constructor(e,n){super();i(this,"element");i(this,"session",C.getSession());i(this,"user",this.session.user);i(this,"ws",m.getWS().ws);this.element=document.createElement("ul"),g.list&&this.addClass(g.list),n&&this.addClass(n),e.forEach(s=>{s!==this.user.login&&(this.session.addEntryToUnreadMessagesNumber(s),this.createNewItem(s),this.ws.send(JSON.stringify({id:String(_()),type:"MSG_FROM_USER",payload:{user:{login:s}}})))})}createNewItem(e,n){const s=new Mt;s.id=e;const a=new o(g.unreadMessages),d=new o(g.textBlock,"span",e);s.appendChild(d),a.appendChild(new B(bt)),a.addClass(g.hidden),s.appendChild(a),n?(s.addClass(g.offline),this.appendChild(s)):this.prepend(s)}filter(e){this.children.forEach(n=>{n.textContent.includes(e)&&!this.node.contains(n.node)&&(n.node.classList.contains(g.offline)?this.node.appendChild(n.node):this.node.prepend(n.node)),n.textContent.includes(e)||this.node.contains(n.node)&&this.node.removeChild(n.node)})}addOfflineUsers(e){e.forEach(n=>{this.createNewItem(n,!0),this.ws.send(JSON.stringify({id:String(_()),type:"MSG_FROM_USER",payload:{user:{login:n}}}))})}setUserOnline(e){let n=!0;this.children.forEach(s=>{s.id===e&&(s.removeClass(g.offline),n=!1)}),n&&this.createNewItem(e)}setUserOffline(e){let n=!0;this.children.forEach(s=>{s.id===e&&(s.addClass(g.offline),n=!1)}),n&&this.createNewItem(e,!0)}updateUnreadMessagesNumber(e){const n=this.session.getUnreadMessagesNumber(e)||0;n&&this.children.forEach(s=>{const a=s.node.lastElementChild;s.id===e?(a.classList.remove(g.hidden),a&&(a.textContent=n.toString())):a.classList.add(g.hidden)})}}const xt="data:image/svg+xml,%3csvg%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M16%206L5%2017L1%2013'%20stroke='hsl(96,%2016%25,%2064%25)'%20stroke-width='2'%20stroke-linecap='round'/%3e%3c/svg%3e",kt="data:image/svg+xml,%3csvg%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M12%2017L11.2929%2017.7071L12%2018.4142L12.7071%2017.7071L12%2017ZM23.7071%206.70711C24.0976%206.31658%2024.0976%205.68342%2023.7071%205.29289C23.3166%204.90237%2022.6834%204.90237%2022.2929%205.29289L23.7071%206.70711ZM5%2017L4.29289%2017.7071L5%2018.4142L5.70711%2017.7071L5%2017ZM16.7071%206.70711C17.0976%206.31658%2017.0976%205.68342%2016.7071%205.29289C16.3166%204.90237%2015.6834%204.90237%2015.2929%205.29289L16.7071%206.70711ZM1.70711%2012.2929C1.31658%2011.9024%200.683418%2011.9024%200.292893%2012.2929C-0.0976311%2012.6834%20-0.0976311%2013.3166%200.292893%2013.7071L1.70711%2012.2929ZM12.7071%2017.7071L23.7071%206.70711L22.2929%205.29289L11.2929%2016.2929L12.7071%2017.7071ZM9.29289%2015.7071L11.2929%2017.7071L12.7071%2016.2929L10.7071%2014.2929L9.29289%2015.7071ZM5.70711%2017.7071L16.7071%206.70711L15.2929%205.29289L4.29289%2016.2929L5.70711%2017.7071ZM0.292893%2013.7071L4.29289%2017.7071L5.70711%2016.2929L1.70711%2012.2929L0.292893%2013.7071Z'%20fill='hsl(96,%2016%25,%2064%25)'/%3e%3c/svg%3e",Bt="data:image/svg+xml,%3csvg%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M12%2017L11.2929%2017.7071L12%2018.4142L12.7071%2017.7071L12%2017ZM23.7071%206.70711C24.0976%206.31658%2024.0976%205.68342%2023.7071%205.29289C23.3166%204.90237%2022.6834%204.90237%2022.2929%205.29289L23.7071%206.70711ZM5%2017L4.29289%2017.7071L5%2018.4142L5.70711%2017.7071L5%2017ZM16.7071%206.70711C17.0976%206.31658%2017.0976%205.68342%2016.7071%205.29289C16.3166%204.90237%2015.6834%204.90237%2015.2929%205.29289L16.7071%206.70711ZM1.70711%2012.2929C1.31658%2011.9024%200.683418%2011.9024%200.292893%2012.2929C-0.0976311%2012.6834%20-0.0976311%2013.3166%200.292893%2013.7071L1.70711%2012.2929ZM12.7071%2017.7071L23.7071%206.70711L22.2929%205.29289L11.2929%2016.2929L12.7071%2017.7071ZM9.29289%2015.7071L11.2929%2017.7071L12.7071%2016.2929L10.7071%2014.2929L9.29289%2015.7071ZM5.70711%2017.7071L16.7071%206.70711L15.2929%205.29289L4.29289%2016.2929L5.70711%2017.7071ZM0.292893%2013.7071L4.29289%2017.7071L5.70711%2016.2929L1.70711%2012.2929L0.292893%2013.7071Z'%20fill='hsl(240,%2056%25,%2064%25)'/%3e%3c/svg%3e",It="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%200%2024%2024'%20width='24'%3e%3cpath%20d='M0%200h24v24H0V0z'%20fill='none'/%3e%3cpath%20d='M3%2017.46v3.04c0%20.28.22.5.5.5h3.04c.13%200%20.26-.05.35-.15L17.81%209.94l-3.75-3.75L3.15%2017.1c-.1.1-.15.22-.15.36zM20.71%207.04c.39-.39.39-1.02%200-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41%200l-1.83%201.83%203.75%203.75%201.83-1.83z'/%3e%3c/svg%3e",yt="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%200%2024%2024'%20width='24'%3e%3cpath%20d='M0%200h24v24H0V0z'%20fill='none'/%3e%3cpath%20d='M6%2019c0%201.1.9%202%202%202h8c1.1%200%202-.9%202-2V9c0-1.1-.9-2-2-2H8c-1.1%200-2%20.9-2%202v10zM9%209h6c.55%200%201%20.45%201%201v8c0%20.55-.45%201-1%201H9c-.55%200-1-.45-1-1v-8c0-.55.45-1%201-1zm6.5-5l-.71-.71c-.18-.18-.44-.29-.7-.29H9.91c-.26%200-.52.11-.7.29L8.5%204H6c-.55%200-1%20.45-1%201s.45%201%201%201h12c.55%200%201-.45%201-1s-.45-1-1-1h-2.5z'/%3e%3c/svg%3e";class St extends o{constructor(e,n=!1){super(h.messageWrapper);i(this,"from");i(this,"messageBlock",new o(h.messageBlock));i(this,"textBlock",new o(h.textBlock,"span"));i(this,"stateIcon",new B(xt,h.stateIcon));i(this,"marker",new o(h.marker,"span","(edited)"));i(this,"contextMenu",new o(h.contextMenu));i(this,"editButton",new p(null,"button",It));i(this,"deleteButton",new p(null,"button",yt));i(this,"ws",m.getWS().ws);i(this,"returnButton",new p(null,"button",k));this.from=e.from,this.addClass(n?h.own:h.chatterer),this.id=e.id;const s=new o(h.title),a=new o(h.nickNameBlock,"div",e.from),d=new Date(e.datetime),u=new o(h.dateBlock,"div",`${d.toLocaleDateString()} ${d.toLocaleTimeString()}`);this.textBlock.textContent=e.text,n&&this.messageBlock.appendChild(this.stateIcon),this.setState(e.status,n),s.appendChildren(a,u),this.appendChildren(s),this.render(n),this.init(n)}render(e){this.messageBlock.prepend(this.textBlock),this.contextMenu.appendChildren(this.editButton,this.deleteButton,this.returnButton),this.appendChild(this.messageBlock),e&&this.appendChild(this.contextMenu)}init(e){this.stateIcon.setAttribute("align","right"),this.contextMenu.addClass(h.hidden),e&&this.addListener("contextmenu",n=>{n.preventDefault(),this.contextMenu.removeClass(h.hidden),this.returnButton.addListener("click",()=>{this.contextMenu.addClass(h.hidden)}),this.editButton.addClass("edit-message"),this.deleteButton.addListener("click",()=>{this.ws.send(JSON.stringify({id:String(_()),type:"MSG_DELETE",payload:{message:{id:this.id}}}))})})}setState(e,n){e.isDelivered&&n&&this.setDelivered(),e.isEdited&&this.setEdited(),e.isReaded&&n&&this.setReaded()}setDelivered(){this.stateIcon.setAttribute("src",kt),this.messageBlock.appendChild(this.stateIcon)}setEdited(){this.messageBlock.appendChild(this.marker)}setReaded(){this.node.classList.contains(h.own)&&(this.stateIcon.setAttribute("src",Bt),this.messageBlock.appendChild(this.stateIcon))}handleVisible(e){const n=e.node.getBoundingClientRect(),s=this.node.getBoundingClientRect();if(s.top>=n.top&&s.left>=n.left&&s.bottom-4<=n.bottom&&s.right<=n.right&&this.node.classList.contains(h.chatterer)){const d={id:String(_()),type:"MSG_READ",payload:{message:{id:this.id}}};this.ws.send(JSON.stringify(d))}}getMessage(){return this.textBlock.textContent}setMessage(e){this.textBlock.textContent=e}hideContextMenu(){this.contextMenu.addClass(h.hidden)}getFrom(){return this.from}}const Nt="_modal-window_1ir9a_1",Et="_message-box_1ir9a_46",Rt="_return-button_1ir9a_51",S={"modal-window":"_modal-window_1ir9a_1",modalWindow:Nt,"message-box":"_message-box_1ir9a_46",messageBox:Et,"return-button":"_return-button_1ir9a_51",returnButton:Rt};class $ extends o{constructor(e,n){super();i(this,"element");i(this,"returnButton",new p(()=>{this.close()},"button",k,S.returnButton));i(this,"messageBox",new o(S.messageBox));this.element=document.createElement("dialog"),e&&(this.messageBox.textContent=e),n&&this.open(),this.addClass(S.modalWindow),this.appendChildren(this.messageBox,this.returnButton)}open(){this.setAttribute("open")}close(){this.element.close()}setMessage(e){this.textContent=e}}const Tt="Select a user in the side bar to send a message...",P="Write and send your first message using the form below...";class At extends o{constructor(){super(c.ChatPage);i(this,"ws",m.getWS().ws);i(this,"session",C.getSession());i(this,"state","");i(this,"user",this.session.user);i(this,"userList",null);i(this,"sideBar",new o(c.sideBar,"aside"));i(this,"searchInput",new R("Find user...",c.searchInput));i(this,"hintMessage",new o(c.hintMessage,"div",Tt));i(this,"nickNameBlock",new o(c.nickName));i(this,"chattererStatusBlock",new o(c.chattererStatus));i(this,"sendMessageForm",new o(c.sendMessage,"form"));i(this,"sendMessageInput",new R("Message...",c.sendMessageInput));i(this,"sendMessageButton",new p(null,"submit",Ze,c.lowButton));i(this,"cancelEditButton",new p(null,"button",Je,c.cancelEditButton));i(this,"chattererName","");i(this,"chatWrapper",new o(c.chatWrapper));i(this,"divider",new o(c.divider));i(this,"sendMessage",()=>{this.sendMessageInput.value.length&&this.chattererName.length&&this.ws.send(JSON.stringify({id:String(_()),type:"MSG_SEND",payload:{message:{to:this.chattererName,text:this.sendMessageInput.value}}})),this.sendMessageInput.value=""});i(this,"finishEditMessage",()=>{this.cancelEditButton.addClass(c.hidden),this.sendMessageInput.value="",this.sendMessageButton.node.onclick=this.sendMessage});this.init(),this.render(this.user.login)}render(e){const n=new it(e),s=new o(c.chat,"main"),a=new o(c.chatSection,"section"),d=new o(c.chatTitle),u=new p(()=>{this.sideBar.addClass(c.visible)},"button",k,c.lowButton,c.returnButton);this.sendMessageForm.appendChildren(this.sendMessageInput,this.sendMessageButton),d.appendChildren(this.nickNameBlock,this.chattererStatusBlock,u),this.chatWrapper.appendChildren(this.hintMessage),a.appendChildren(this.sendMessageForm,d,this.chatWrapper),s.appendChildren(this.sideBar,a);const l=new gt;this.appendChildren(n,s,l)}init(){this.ws.send(JSON.stringify({id:String(_()),type:"USER_ACTIVE",payload:null})),this.ws.onmessage=n=>{var a,d,u;const s=JSON.parse(n.data);if(s.type==="USER_LOGIN"&&(this.user.login=s.payload.user.login,s.payload.user.isLogined&&(window.location.hash="/main",this.user.isLogined=!0)),s.type==="ERROR"&&this.appendChild(new $(`Error: ${s.payload.error}`,!0)),s.type==="USER_LOGOUT"&&(this.user.isLogined=!1,this.state="logout",window.location.hash="/login"),s.type==="USER_ACTIVE"&&this.createUsersList(s.payload.users.map(l=>l.login)),s.type==="USER_INACTIVE"&&this.userList.addOfflineUsers(s.payload.users.map(l=>l.login)),s.type==="MSG_FROM_USER"&&(s.payload.messages.length&&this.state==="startChat"?(this.createCorrespondence(s.payload.messages),this.state=""):this.state==="startChat"?(this.hintMessage.textContent=P,this.chatWrapper.appendChild(this.hintMessage)):this.updateUnreadMessagesNumber(s.payload.messages)),s.type==="USER_EXTERNAL_LOGIN"&&((a=this.userList)==null||a.setUserOnline(s.payload.user.login),this.nickNameBlock.textContent===s.payload.user.login&&(this.chattererStatusBlock.textContent="online")),s.type==="USER_EXTERNAL_LOGOUT"&&((d=this.userList)==null||d.setUserOffline(s.payload.user.login),this.nickNameBlock.textContent===s.payload.user.login&&(this.chattererStatusBlock.textContent="offline")),s.type==="MSG_SEND"&&this.createMessage(s.payload.message),s.type==="MSG_DELIVER"&&this.session.getMessage(s.payload.message.id).setDelivered(),s.type==="MSG_READ"){const l=this.session.getMessage(s.payload.message.id);l==null||l.setReaded();const T=(l==null?void 0:l.getFrom())||"";this.session.decrementUnreadMessagesNumber(T),(u=this.userList)==null||u.updateUnreadMessagesNumber(T)}if(s.type==="MSG_DELETE"&&this.session.deleteMessage(s.payload.message.id),s.type==="MSG_EDIT"){const l=this.session.getMessage(s.payload.message.id);l==null||l.setMessage(s.payload.message.text),l==null||l.setEdited()}};const e=new o(c.dividerText,"span","new messages");this.divider.appendChild(e),this.chatWrapper.addListener("scroll",()=>{this.session.iterateMessages(n=>n.handleVisible(this.chatWrapper))}),this.chatWrapper.addListener("click",n=>{const s=n.target;if(s.closest(".edit-message")){const a=s.closest(".edit-message"),d=a==null?void 0:a.closest(`.${h.contextMenu}`),u=d==null?void 0:d.closest(`.${h.messageWrapper}`),l=u==null?void 0:u.id;this.editMessage(l)}}),this.sendMessageButton.setAttribute("disabled"),this.sendMessageInput.setAttribute("disabled"),this.cancelEditButton.addClass(c.hidden),this.cancelEditButton.node.onclick=this.finishEditMessage,this.sendMessageButton.node.onclick=this.sendMessage,this.sendMessageForm.appendChild(this.cancelEditButton)}createUsersList(e){this.userList=new Lt(e,c.userList),this.searchInput.addListener("input",()=>{this.userList.filter(this.searchInput.value)}),this.userList.addListener("click",n=>{var a,d;this.sendMessageButton.removeAttribute("disabled"),this.sendMessageInput.removeAttribute("disabled"),this.session.clearMessages(),this.chatWrapper.removeChildren();const s=n.target;this.chattererName=((a=s.closest("li"))==null?void 0:a.firstChild.textContent)||"",this.nickNameBlock.textContent=this.chattererName,this.chattererStatusBlock.textContent=(d=s.closest("li"))!=null&&d.classList.value.includes("offline")?"offline":"online",this.state="startChat",this.ws.send(JSON.stringify({id:String(_()),type:"MSG_FROM_USER",payload:{user:{login:this.chattererName}}}))}),this.sideBar.appendChildren(this.searchInput,this.userList),this.ws.send(JSON.stringify({id:String(_()),type:"USER_INACTIVE",payload:null}))}updateUnreadMessagesNumber(e){var n;if(e.length){let s="";e.forEach(a=>{a.from!==this.user.login&&!a.status.isReaded&&(this.session.incrementUnreadMessagesNumber(a.from),s=a.from)}),s&&((n=this.userList)==null||n.updateUnreadMessagesNumber(s))}}createCorrespondence(e){e.length?e.forEach(n=>this.createMessage(n)):(this.hintMessage.removeClass(c.hidden),this.hintMessage.textContent=P)}createMessage(e){const n=this.user.login===e.from;if(e.from===this.chattererName||n){this.hintMessage.addClass(c.hidden);const s=new St(e,n);this.session.putMessage(e.id,s),this.chatWrapper.appendChild(s),!e.status.isReaded&&!this.session.isThereUnread&&!n?(this.session.isThereUnread=!0,this.chatWrapper.appendChild(this.divider),this.scrollToDivider()):this.scrollToEnd()}}editMessage(e){const n=this.session.getMessage(e),s=()=>{this.finishEditMessage(),n==null||n.returnButton.removeListener("click",s)};n==null||n.returnButton.addListener("click",s),this.sendMessageInput.value=n==null?void 0:n.getMessage(),n==null||n.hideContextMenu(),this.cancelEditButton.removeClass(c.hidden),this.sendMessageInput.node.focus(),this.sendMessageButton.node.onclick=()=>{this.sendMessageInput.value.length&&(this.ws.send(JSON.stringify({id:String(_()),type:"MSG_EDIT",payload:{message:{id:e,text:this.sendMessageInput.value}}})),this.finishEditMessage())}}scrollToEnd(){this.chatWrapper.node.scrollTop=this.chatWrapper.node.scrollHeight}scrollToDivider(){const e=this.chatWrapper.node.getBoundingClientRect(),s=this.divider.node.getBoundingClientRect().top-e.top;this.chatWrapper.node.scrollTop+=s}getState(){return this.state}}const Ut="_main_abkt9_1",Pt={main:Ut},Ot="_login-form_19ttn_1",Vt="_about-link_19ttn_9",qt="_hidden_19ttn_18",zt="_tooltip_19ttn_25",Wt="_buttons-wrapper_19ttn_33",M={"login-form":"_login-form_19ttn_1",loginForm:Ot,"about-link":"_about-link_19ttn_9",aboutLink:Vt,hidden:qt,tooltip:zt,"buttons-wrapper":"_buttons-wrapper_19ttn_33",buttonsWrapper:Wt},$t="_fieldset_1vaeb_1",jt={fieldset:$t};class Dt extends o{constructor(e){super();i(this,"legend");i(this,"element");this.element=document.createElement("fieldset"),this.addClass(jt.fieldset),e&&(this.legend=new o("","legend",e),this.appendChild(this.legend))}}const Ht="_label_148u2_1",Gt="_tooltip_148u2_8",Ft={label:Ht,tooltip:Gt},Zt="_password-input_11kwa_1",Jt="_invalid_11kwa_11",N={"password-input":"_password-input_11kwa_1",passwordInput:Zt,invalid:Jt};class Kt extends W{constructor(t){super(N.passwordInput),this.setAttribute("type","password"),t&&this.setAttribute("placeholder",t)}setInvalid(){this.addClass(N.invalid)}setValid(){this.removeClass(N.invalid)}}class O extends o{constructor(e,n,s){super();i(this,"input");i(this,"element");this.element=document.createElement("label"),this.textContent=e,this.addClass(Ft.label),this.input=n==="text"?new R(s):new Kt(s),this.appendChild(this.input)}get value(){return this.input.value}set value(e){this.input.value=e}setInvalid(){this.input.setInvalid()}setValid(){this.input.setValid()}}const Xt="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20enable-background='new%200%200%2024%2024'%20height='24'%20viewBox='0%200%2024%2024'%20width='24'%3e%3cg%3e%3crect%20fill='none'%20height='24'%20width='24'/%3e%3crect%20fill='none'%20height='24'%20width='24'/%3e%3c/g%3e%3cg%3e%3cpath%20d='M10.3,7.7L10.3,7.7c-0.39,0.39-0.39,1.01,0,1.4l1.9,1.9H3c-0.55,0-1,0.45-1,1v0c0,0.55,0.45,1,1,1h9.2l-1.9,1.9%20c-0.39,0.39-0.39,1.01,0,1.4l0,0c0.39,0.39,1.01,0.39,1.4,0l3.59-3.59c0.39-0.39,0.39-1.02,0-1.41L11.7,7.7%20C11.31,7.31,10.69,7.31,10.3,7.7z%20M20,19h-7c-0.55,0-1,0.45-1,1v0c0,0.55,0.45,1,1,1h7c1.1,0,2-0.9,2-2V5c0-1.1-0.9-2-2-2h-7%20c-0.55,0-1,0.45-1,1v0c0,0.55,0.45,1,1,1h7V19z'/%3e%3c/g%3e%3c/svg%3e",Yt="The name must be in English letters, starting with capital.",Qt="Minimum name length - 2 and maximum - 12 characters.",es="Minimum password length - 4 characters.",ts="Must contain at least 1 English letter and 1 number.";class ss extends o{constructor(){super();i(this,"fieldset",new Dt("Authorization"));i(this,"nameInput",new O("Name","text","Enter your name"));i(this,"passwordInput",new O("Password","password","Enter password"));i(this,"firstRuleNameTooltip",new o(M.tooltip));i(this,"secondRuleNameTooltip",new o(M.tooltip));i(this,"firstRulePasswordTooltip",new o(M.tooltip));i(this,"secondRulePasswordTooltip",new o(M.tooltip));i(this,"loginButton",new p(null,"submit",Xt,"","login-button"));i(this,"infoButton",new p(()=>{window.location.hash="/about"},"button",z));i(this,"isNameValid",!1);i(this,"isPasswordValid",!1);i(this,"user",C.getSession().user);i(this,"ws",m.getWS().ws);i(this,"element");this.element=document.createElement("form"),this.addClass(M.loginForm),this.init(),this.render()}render(){this.fieldset.appendChildren(this.nameInput,this.firstRuleNameTooltip,this.secondRuleNameTooltip,this.passwordInput,this.firstRulePasswordTooltip,this.secondRulePasswordTooltip);const e=new o(M.buttonsWrapper);e.appendChildren(this.loginButton,this.infoButton),this.appendChildren(this.fieldset,e)}init(){this.addListener("submit",e=>{e.preventDefault()}),this.loginButton.disable(),this.loginButton.addListener("click",()=>{this.user.password=this.passwordInput.value,this.ws.send(JSON.stringify({id:String(_()),type:"USER_LOGIN",payload:{user:{login:`${this.nameInput.value}`,password:`${this.passwordInput.value}`}}}))}),this.nameInput.addListener("input",()=>{this.validateName()}),this.passwordInput.addListener("input",()=>{this.validatePassword()}),this.addListener("input",()=>{this.isNameValid&&this.isPasswordValid?this.loginButton.enable():this.loginButton.disable()})}validateName(){let e=!1;/^[A-Z][a-zA-Z]*$/.test(this.nameInput.value)?(this.firstRuleNameTooltip.textContent="",e=!0):(this.firstRuleNameTooltip.textContent=Yt,this.nameInput.setInvalid(),this.loginButton.disable()),/.{2,12}/.test(this.nameInput.value)?(this.secondRuleNameTooltip.textContent="",e&&(e=!0)):(this.secondRuleNameTooltip.textContent=Qt,this.nameInput.setInvalid(),this.loginButton.disable(),e=!1),e&&(this.nameInput.setValid(),this.isNameValid=!0),this.isNameValid=e}validatePassword(){let e=!1;/.{4,}/.test(this.passwordInput.value)?(this.firstRulePasswordTooltip.textContent="",e=!0):(this.firstRulePasswordTooltip.textContent=es,this.passwordInput.setInvalid(),this.loginButton.disable()),/^(?=.*[a-zA-Z])(?=.*\d).+/.test(this.passwordInput.value)?(this.secondRulePasswordTooltip.textContent="",e&&(e=!0)):(this.secondRulePasswordTooltip.textContent=ts,this.passwordInput.setInvalid(),this.loginButton.disable(),e=!1),e&&this.passwordInput.setValid(),this.isPasswordValid=e}}class V extends o{constructor(){super(Pt.main,"main"),this.appendChild(new ss)}}const ns="ws://127.0.0.1:4000/";class is extends o{constructor(e){super(e);i(this,"user",C.getSession().user);i(this,"chatPage",null);this.init()}init(){const{ws:e}=m.getWS(ns);e.onmessage=s=>{const a=JSON.parse(s.data);a.type==="USER_LOGIN"&&(this.user.login=a.payload.user.login,a.payload.user.isLogined&&(window.location.hash="/main",this.user.isLogined=!0)),a.type==="ERROR"&&this.appendChild(new $(`Error: ${a.payload.error}`,!0))};let n=window.location.hash.slice(2);n?this.renderNewPage(n):(window.location.hash="#/",this.renderNewPage("")),window.onhashchange=()=>{n=window.location.hash.slice(2),this.renderNewPage(n)}}renderNewPage(e){switch(this.removeChildren(),e){case"":this.appendChild(new V);break;case"login":this.user.isLogined?window.location.hash="/main":this.appendChild(new V);break;case"main":this.user.isLogined?(this.chatPage&&this.chatPage.getState()==="logout"&&(this.chatPage=null),this.chatPage||(this.chatPage=new At),this.appendChild(this.chatPage)):(this.chatPage=null,window.location.hash="/login");break;case"about":this.appendChild(new _e);break;default:this.appendChild(new ie);break}}}const as=new is("app-container");document.body.appendChild(as.node);
